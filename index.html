<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>üé∞ Slot Machine Pro</title>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Identity Services -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    
    <style>
        /* ===== RESET & BASE STYLES ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* ÿßŸÑÿ£ŸÑŸàÿßŸÜ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ© */
            --primary: #8B5CF6;
            --primary-dark: #7C3AED;
            --primary-light: #A78BFA;
            --secondary: #EC4899;
            --secondary-dark: #DB2777;
            --accent: #10B981;
            --accent-dark: #059669;
            --danger: #EF4444;
            --danger-dark: #DC2626;
            --warning: #F59E0B;
            --warning-dark: #D97706;
            --info: #3B82F6;
            --dark: #1F2937;
            --darker: #111827;
            --darkest: #0B1121;
            --light: #F3F4F6;
            --lighter: #F9FAFB;
            --gray: #6B7280;
            --gray-light: #9CA3AF;
            --gray-dark: #4B5563;
            
            /* ÿßŸÑÿ∏ŸÑÿßŸÑ */
            --shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            --shadow-light: 0 5px 15px rgba(0, 0, 0, 0.2);
            --shadow-dark: 0 15px 35px rgba(0, 0, 0, 0.4);
            --shadow-inset: inset 0 2px 5px rgba(0, 0, 0, 0.2);
            --shadow-glow: 0 0 20px rgba(139, 92, 246, 0.5);
            
            /* ÿßŸÑÿ≤ŸàÿßŸäÿß */
            --radius: 20px;
            --radius-sm: 12px;
            --radius-lg: 28px;
            --radius-xl: 36px;
            --radius-full: 9999px;
            
            /* ÿßŸÑÿßŸÜÿ™ŸÇÿßŸÑÿßÿ™ */
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            
            /* ÿ£ÿ≠ÿ¨ÿßŸÖ ÿßŸÑÿ±ŸÖŸàÿ≤ */
            --symbol-size: 80px;
        }

        html, body {
            height: 100%;
            overflow: hidden;
        }

        body {
            font-family: 'Tajawal', sans-serif;
            background: linear-gradient(135deg, var(--darker) 0%, var(--darkest) 100%);
            color: var(--light);
            direction: rtl;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
        }

        /* ===== LAYOUT ===== */
        .container {
            height: 100vh;
            display: flex;
            flex-direction: column;
            padding: 20px;
            gap: 20px;
        }

        /* ===== HEADER ===== */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: rgba(31, 41, 55, 0.95);
            backdrop-filter: blur(20px);
            border-radius: var(--radius);
            border: 2px solid rgba(139, 92, 246, 0.4);
            box-shadow: var(--shadow);
            flex-shrink: 0;
        }

        .balance-container {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            padding: 15px 30px;
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            gap: 15px;
            box-shadow: var(--shadow);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .balance-icon {
            font-size: 2em;
        }

        .balance-amount {
            font-size: 2.5em;
            font-weight: 900;
        }

        .auth-section {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(255, 255, 255, 0.1);
            padding: 10px 20px;
            border-radius: var(--radius-sm);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
        }

        /* ===== GAME AREA ===== */
        .game-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 20px;
            overflow: hidden;
        }

        /* ===== SLOT MACHINE ===== */
        .slot-machine {
            flex: 1;
            background: rgba(31, 41, 55, 0.95);
            backdrop-filter: blur(20px);
            border-radius: var(--radius);
            padding: 30px;
            box-shadow: var(--shadow);
            border: 3px solid rgba(139, 92, 246, 0.4);
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .slot-machine::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 40%, rgba(255,255,255,0.03) 50%, transparent 60%);
            pointer-events: none;
            z-index: 1;
        }

        .slot-frame {
            flex: 1;
            background: linear-gradient(145deg, #1a202c, #2d3748);
            border-radius: var(--radius);
            border: 4px solid rgba(236, 72, 153, 0.4);
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .slot-frame::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 8px;
            background: linear-gradient(90deg, var(--primary), var(--secondary), var(--accent));
            z-index: 2;
        }

        .slot-frame::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 8px;
            background: linear-gradient(90deg, var(--accent), var(--secondary), var(--primary));
            z-index: 2;
        }

        .reels-container {
            display: flex;
            gap: 20px;
            padding: 20px;
            height: 100%;
            width: 100%;
            align-items: center;
            overflow-x: auto;
            overflow-y: hidden;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .reels-container::-webkit-scrollbar {
            display: none;
        }

        .reel-column {
            display: flex;
            flex-direction: column;
            gap: 20px;
            min-width: 120px;
            flex-shrink: 0;
        }

        .reel-cell {
            background: linear-gradient(145deg, #2d3748, #1f2937);
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            aspect-ratio: 1;
            position: relative;
            transition: var(--transition);
            box-shadow: 
                inset 0 4px 8px rgba(0, 0, 0, 0.4),
                0 4px 12px rgba(0, 0, 0, 0.3);
            border: 3px solid rgba(255, 255, 255, 0.08);
            overflow: hidden;
        }

        .reel-cell::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255,255,255,0.08), transparent 60%);
            pointer-events: none;
        }

        .symbol {
            font-size: 3.5em;
            filter: drop-shadow(0 3px 5px rgba(0,0,0,0.5));
            transition: var(--transition);
        }

        .reel-cell.spinning {
            animation: spinReel 0.12s linear infinite;
            background: linear-gradient(145deg, #3b4252, #2d3748);
            box-shadow: 
                inset 0 0 20px rgba(139, 92, 246, 0.3),
                0 0 30px rgba(139, 92, 246, 0.2);
        }

        @keyframes spinReel {
            0% { transform: translateY(0) rotateX(0); }
            25% { transform: translateY(-20px) rotateX(15deg); }
            50% { transform: translateY(-40px) rotateX(0); }
            75% { transform: translateY(-60px) rotateX(-15deg); }
            100% { transform: translateY(-80px) rotateX(0); }
        }

        .reel-cell.matched {
            animation: pulseGlow 0.6s ease infinite alternate;
            border-color: var(--accent);
            box-shadow: 
                0 0 40px var(--accent),
                inset 0 0 30px rgba(16, 185, 129, 0.4);
            z-index: 10;
            transform: scale(1.05);
        }

        @keyframes pulseGlow {
            0% { 
                transform: scale(1.05) rotateY(0);
                box-shadow: 0 0 30px var(--accent), inset 0 0 20px rgba(16, 185, 129, 0.3);
            }
            100% { 
                transform: scale(1.12) rotateY(8deg);
                box-shadow: 0 0 60px var(--accent), inset 0 0 40px rgba(16, 185, 129, 0.5);
            }
        }

        /* ===== CONTROL PANEL ===== */
        .control-panel {
            background: rgba(31, 41, 55, 0.95);
            backdrop-filter: blur(20px);
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: var(--shadow);
            border: 2px solid rgba(236, 72, 153, 0.4);
            display: flex;
            flex-direction: column;
            gap: 20px;
            flex-shrink: 0;
        }

        .bet-controls {
            background: rgba(0, 0, 0, 0.5);
            border-radius: var(--radius);
            padding: 20px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
        }

        .bet-controls::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
        }

        .bet-display {
            text-align: center;
            margin-bottom: 20px;
        }

        .bet-amount {
            font-size: 3.5em;
            font-weight: 900;
            color: var(--accent);
            text-shadow: 0 0 25px rgba(16, 185, 129, 0.6);
        }

        .bet-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .spin-controls {
            display: flex;
            gap: 15px;
            margin-top: 10px;
        }

        .btn {
            border: none;
            border-radius: var(--radius-sm);
            font-family: 'Tajawal', sans-serif;
            font-size: 1.2em;
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 18px;
            position: relative;
            overflow: hidden;
            transform-style: preserve-3d;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.15) 50%, transparent 70%);
            transform: translateX(-100%);
            transition: transform 0.6s;
        }

        .btn:hover:not(:disabled)::before {
            transform: translateX(100%);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            flex: 2;
            box-shadow: 0 8px 30px rgba(139, 92, 246, 0.4);
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 15px 40px rgba(139, 92, 246, 0.6);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger), var(--danger-dark));
            color: white;
            flex: 1;
            box-shadow: 0 8px 30px rgba(239, 68, 68, 0.4);
        }

        .btn-danger:hover:not(:disabled) {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 15px 40px rgba(239, 68, 68, 0.6);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--accent), var(--accent-dark));
            color: white;
        }

        .btn-bet {
            background: rgba(255, 255, 255, 0.1);
            color: var(--light);
            border: 2px solid rgba(255, 255, 255, 0.15);
            font-size: 1.1em;
            padding: 15px 10px;
            backdrop-filter: blur(10px);
        }

        .btn-bet:hover:not(.active):not(:disabled) {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
        }

        .btn-bet.active {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            box-shadow: 0 0 25px rgba(139, 92, 246, 0.5);
            border-color: var(--primary-light);
            transform: scale(1.05);
        }

        /* ===== WIN DISPLAY ===== */
        .win-display {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: linear-gradient(135deg, rgba(31, 41, 55, 0.98), rgba(17, 24, 39, 0.98));
            padding: 40px 60px;
            border-radius: var(--radius-xl);
            border: 6px solid;
            text-align: center;
            z-index: 2000;
            display: none;
            box-shadow: 
                var(--shadow-dark),
                0 0 80px rgba(251, 191, 36, 0.4),
                inset 0 0 40px rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(30px);
            border-image: linear-gradient(45deg, var(--primary), var(--secondary), var(--accent)) 1;
        }

        .win-display.active {
            display: block;
            animation: winPopIn 0.8s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        @keyframes winPopIn {
            0% { 
                transform: translate(-50%, -50%) scale(0) rotate(-20deg); 
                opacity: 0; 
            }
            70% { 
                transform: translate(-50%, -50%) scale(1.15) rotate(10deg); 
                opacity: 1; 
            }
            100% { 
                transform: translate(-50%, -50%) scale(1) rotate(0); 
                opacity: 1; 
            }
        }

        .win-display.normal-win {
            border-color: var(--accent);
        }

        .win-display.big-win {
            border-color: var(--warning);
        }

        .win-display.mega-win {
            border-color: #FBBF24;
        }

        .win-title {
            font-size: 2.5em;
            font-weight: 900;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #FBBF24, #F59E0B, #DC2626);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 2px 20px rgba(251, 191, 36, 0.4);
        }

        .win-amount {
            font-size: 4em;
            font-weight: 900;
            margin: 20px 0;
            text-shadow: 0 0 50px #FBBF24;
            animation: winAmountGlow 2s ease-in-out infinite;
            background: linear-gradient(135deg, #FBBF24, #F59E0B, #DC2626);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        @keyframes winAmountGlow {
            0%, 100% { 
                text-shadow: 
                    0 0 40px #FBBF24,
                    0 0 80px rgba(251, 191, 36, 0.6); 
            }
            50% { 
                text-shadow: 
                    0 0 60px #FBBF24,
                    0 0 120px rgba(251, 191, 36, 0.8); 
            }
        }

        .win-multiplier {
            font-size: 1.5em;
            color: var(--light);
            margin-bottom: 25px;
            background: rgba(255, 255, 255, 0.1);
            display: inline-block;
            padding: 12px 30px;
            border-radius: var(--radius-full);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .win-close {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: var(--radius-sm);
            font-size: 1.2em;
            font-weight: 700;
            cursor: pointer;
            margin-top: 20px;
            transition: var(--transition);
            box-shadow: 0 8px 30px rgba(139, 92, 246, 0.4);
            position: relative;
            overflow: hidden;
        }

        .win-close:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 15px 40px rgba(139, 92, 246, 0.6);
        }

        /* ===== TOAST ===== */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(135deg, rgba(31, 41, 55, 0.98), rgba(17, 24, 39, 0.98));
            color: white;
            padding: 15px 25px;
            border-radius: var(--radius);
            border-right: 5px solid;
            box-shadow: var(--shadow);
            transform: translateX(100%);
            transition: transform 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
            z-index: 1000;
            backdrop-filter: blur(20px);
            max-width: 350px;
            display: flex;
            align-items: center;
            gap: 15px;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.success {
            border-right-color: var(--accent);
        }

        .toast.error {
            border-right-color: var(--danger);
        }

        .toast.warning {
            border-right-color: var(--warning);
        }

        .toast.info {
            border-right-color: var(--info);
        }

        .toast-icon {
            font-size: 1.5em;
            flex-shrink: 0;
        }

        /* ===== LOGIN SCREEN ===== */
        .login-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, var(--darker) 0%, var(--darkest) 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 3000;
            padding: 20px;
        }

        .login-content {
            background: linear-gradient(135deg, rgba(31, 41, 55, 0.95), rgba(17, 24, 39, 0.95));
            padding: 50px;
            border-radius: var(--radius-xl);
            border: 3px solid rgba(139, 92, 246, 0.4);
            text-align: center;
            max-width: 500px;
            width: 100%;
            box-shadow: var(--shadow-dark);
            backdrop-filter: blur(20px);
        }

        .login-logo {
            font-size: 4em;
            margin-bottom: 20px;
            animation: logoFloat 3s ease-in-out infinite;
            filter: drop-shadow(0 5px 15px rgba(139, 92, 246, 0.5));
        }

        @keyframes logoFloat {
            0%, 100% { transform: translateY(0) rotate(0); }
            50% { transform: translateY(-20px) rotate(5deg); }
        }

        .login-title {
            font-size: 2.5em;
            font-weight: 900;
            margin-bottom: 10px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .login-subtitle {
            color: var(--gray-light);
            margin-bottom: 30px;
            font-size: 1.2em;
        }

        .gsi-material-button {
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: var(--radius);
            padding: 15px 30px;
            font-size: 1.2em;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin: 20px auto;
            transition: var(--transition);
            box-shadow: 0 8px 30px rgba(139, 92, 246, 0.4);
        }

        .gsi-material-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(139, 92, 246, 0.6);
        }

        .gsi-material-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
                gap: 10px;
            }
            
            .header {
                padding: 15px;
                flex-direction: column;
                gap: 15px;
            }
            
            .auth-section {
                width: 100%;
                justify-content: center;
            }
            
            .balance-container {
                width: 100%;
                justify-content: center;
            }
            
            .balance-amount {
                font-size: 2em;
            }
            
            .slot-machine {
                padding: 15px;
            }
            
            .reels-container {
                gap: 10px;
                padding: 10px;
            }
            
            .reel-column {
                min-width: 80px;
                gap: 10px;
            }
            
            .symbol {
                font-size: 2.5em;
            }
            
            .control-panel {
                padding: 15px;
            }
            
            .bet-buttons {
                grid-template-columns: repeat(3, 1fr);
                gap: 10px;
            }
            
            .btn {
                padding: 15px;
                font-size: 1em;
            }
            
            .bet-amount {
                font-size: 2.8em;
            }
            
            .win-display {
                padding: 30px 40px;
                width: 95%;
            }
            
            .win-amount {
                font-size: 3em;
            }
            
            .win-title {
                font-size: 2em;
            }
        }

        @media (max-width: 480px) {
            .reel-column {
                min-width: 70px;
            }
            
            .symbol {
                font-size: 2em;
            }
            
            .bet-buttons {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .balance-amount {
                font-size: 1.8em;
            }
            
            .bet-amount {
                font-size: 2.2em;
            }
            
            .win-amount {
                font-size: 2.5em;
            }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div class="login-screen" id="loginScreen">
        <div class="login-content">
            <div class="login-logo">üé∞</div>
            <div class="login-title">Slot Machine Pro</div>
            <div class="login-subtitle">ÿ≥ÿ¨ŸÑ ÿßŸÑÿØÿÆŸàŸÑ ŸÑŸÑÿπÿ® ÿßŸÑÿ≠ŸÇŸäŸÇŸä</div>
            
            <div id="gsi-button"></div>
            
            <div style="margin-top: 30px; color: var(--gray-light); font-size: 0.9em;">
                ‚ö†Ô∏è ÿßŸÑÿ±ÿµŸäÿØ Ÿäÿ®ÿØÿ£ ŸÖŸÜ 0 ŸàŸäÿ™ŸÖ ÿ≠ŸÅÿ∏Ÿá ŸÅŸä ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
            </div>
        </div>
    </div>

    <!-- Main Game Container -->
    <div class="container" id="gameContainer" style="display: none;">
        <!-- Header -->
        <header class="header">
            <div class="balance-container">
                <span class="balance-icon">üí∞</span>
                <span class="balance-amount" id="balance">0</span>
            </div>
            
            <div class="auth-section">
                <div class="user-info" id="userInfo" style="display: none;">
                    <div class="user-avatar" id="userAvatar"></div>
                    <span id="userName"></span>
                </div>
                <button class="btn btn-success" id="logoutBtn" style="display: none;">
                    <i class="fas fa-sign-out-alt"></i> ÿÆÿ±Ÿàÿ¨
                </button>
            </div>
        </header>

        <!-- Game Area -->
        <div class="game-area">
            <!-- Slot Machine -->
            <div class="slot-machine">
                <div class="slot-frame">
                    <div class="reels-container" id="reels">
                        <!-- Will be filled by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Control Panel -->
            <div class="control-panel">
                <div class="bet-controls">
                    <div class="bet-display">
                        <div class="bet-amount" id="currentBet">600</div>
                    </div>
                    
                    <div class="bet-buttons">
                        <button class="btn btn-bet" data-bet="300">300</button>
                        <button class="btn btn-bet" data-bet="600">600</button>
                        <button class="btn btn-bet active" data-bet="1200">1,200</button>
                        <button class="btn btn-bet" data-bet="2400">2,400</button>
                        <button class="btn btn-bet" data-bet="4800">4,800</button>
                        <button class="btn btn-bet" data-bet="9600">9,600</button>
                    </div>
                    
                    <div class="spin-controls">
                        <button class="btn btn-primary" id="spinBtn">
                            <i class="fas fa-play"></i> ÿ™ÿØŸàŸäÿ± (Space)
                        </button>
                        <button class="btn btn-danger" id="stopBtn" disabled>
                            <i class="fas fa-stop"></i> ÿ•ŸäŸÇÿßŸÅ (Space)
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Win Display -->
    <div class="win-display" id="winDisplay">
        <div class="win-title" id="winTitle">üéâ ŸÅŸàÿ≤ ÿ±ÿßÿ¶ÿπ!</div>
        <div class="win-amount" id="winAmount">0</div>
        <div class="win-multiplier">
            ŸÖÿ∂ÿßÿπŸÅ: <span id="winMultiplier">√ó1</span>
        </div>
        <button class="win-close" id="closeWin">ŸÖÿ™ÿßÿ®ÿπÿ© ÿßŸÑŸÑÿπÿ®</button>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast">
        <span class="toast-icon"></span>
        <span class="toast-message"></span>
    </div>

    <!-- Audio Elements -->
    <audio id="spinSound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-slot-machine-spin-1073.mp3" type="audio/mpeg">
    </audio>
    <audio id="stopSound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-arcade-game-jump-coin-216.mp3" type="audio/mpeg">
    </audio>
    <audio id="winSound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3" type="audio/mpeg">
    </audio>
    <audio id="bigWinSound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-big-win-2021.mp3" type="audio/mpeg">
    </audio>
    <audio id="clickSound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-select-click-1109.mp3" type="audio/mpeg">
    </audio>

    <!-- JavaScript -->
    <script>
        // ===== GAME CONSTANTS =====
        const SYMBOLS = [
            { id: 'queen', icon: '‚ôï', multiplier: 15, color: '#FBBF24' },
            { id: 'queen2', icon: '‚ôõ', multiplier: 12, color: '#3B82F6' },
            { id: 'king', icon: '‚ôî', multiplier: 10, color: '#8B5CF6' },
            { id: 'king2', icon: '‚ôö', multiplier: 8, color: '#EF4444' },
            { id: 'rook', icon: '‚ôñ', multiplier: 7, color: '#10B981' },
            { id: 'rook2', icon: '‚ôú', multiplier: 6, color: '#EC4899' },
            { id: 'bishop', icon: '‚ôó', multiplier: 5, color: '#F59E0B' },
            { id: 'bishop2', icon: '‚ôù', multiplier: 4, color: '#DC2626' },
            { id: 'knight', icon: '‚ôò', multiplier: 20, color: '#8B5CF6' },
            { id: 'knight2', icon: '‚ôû', multiplier: 18, color: '#10B981' },
            { id: 'pawn', icon: '‚ôô', multiplier: 3, color: '#3B82F6' },
            { id: 'pawn2', icon: '‚ôü', multiplier: 2, color: '#F59E0B' }
        ];
        
        const BET_OPTIONS = [300, 600, 1200, 2400, 4800, 9600];
        
        // ===== GOOGLE APPS SCRIPT API =====
        const API_URL = 'https://script.google.com/macros/s/AKfycbxzdOGbJgp7zz2IVtnD-sbcyKpcEPSuRGMMq2fOe_0sL6vTwL3pUT2PQ0_Dg43dAxHAoQ/exec';
        
        // ===== GOOGLE AUTH CONFIG =====
        const CLIENT_ID = '739516782894-1q82fhnajlc7fqa3n8jgck7bv9qc4bc5.apps.googleusercontent.com';
        
        // ===== GAME CLASS =====
        class SlotGame {
            constructor() {
                this.balance = 0;
                this.currentBet = 600;
                this.isSpinning = false;
                this.totalSpins = 0;
                this.totalWins = 0;
                this.totalWon = 0;
                this.biggestWin = 0;
                this.consecutiveLosses = 0;
                this.isAuthenticated = false;
                this.user = null;
                this.token = null;
                
                // ŸÜÿ∏ÿßŸÖ ÿßŸÑŸÖÿÆÿßÿ≤ŸÜ ÿßŸÑÿØŸäŸÜÿßŸÖŸäŸÉŸä
                this.stores = {
                    300: { minBalance: 3000, currentBalance: 30000 },
                    600: { minBalance: 6000, currentBalance: 60000 },
                    1200: { minBalance: 12000, currentBalance: 120000 },
                    2400: { minBalance: 24000, currentBalance: 240000 },
                    4800: { minBalance: 48000, currentBalance: 480000 },
                    9600: { minBalance: 96000, currentBalance: 960000 }
                };
                
                // Grid
                this.grid = Array(3).fill().map(() => Array(5).fill(null));
                
                // DOM Elements
                this.elements = {
                    loginScreen: document.getElementById('loginScreen'),
                    gameContainer: document.getElementById('gameContainer'),
                    balance: document.getElementById('balance'),
                    currentBet: document.getElementById('currentBet'),
                    spinBtn: document.getElementById('spinBtn'),
                    stopBtn: document.getElementById('stopBtn'),
                    reels: document.getElementById('reels'),
                    winDisplay: document.getElementById('winDisplay'),
                    winAmount: document.getElementById('winAmount'),
                    winMultiplier: document.getElementById('winMultiplier'),
                    winTitle: document.getElementById('winTitle'),
                    closeWin: document.getElementById('closeWin'),
                    toast: document.getElementById('toast'),
                    userInfo: document.getElementById('userInfo'),
                    userAvatar: document.getElementById('userAvatar'),
                    userName: document.getElementById('userName'),
                    logoutBtn: document.getElementById('logoutBtn')
                };
                
                // Audio
                this.audio = {
                    spin: document.getElementById('spinSound'),
                    stop: document.getElementById('stopSound'),
                    win: document.getElementById('winSound'),
                    bigWin: document.getElementById('bigWinSound'),
                    click: document.getElementById('clickSound')
                };
                
                this.soundEnabled = true;
                this.lastGameResult = null;
                this.currentStore = this.stores[600];
            }
            
            async init() {
                this.createGrid();
                this.setupEventListeners();
                this.initializeGoogleAuth();
                
                // ÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿ¨ŸÑÿ≥ÿ© ÿ≥ÿßÿ®ŸÇÿ©
                const savedToken = localStorage.getItem('google_token');
                const savedUser = localStorage.getItem('google_user');
                
                if (savedToken && savedUser) {
                    try {
                        this.token = savedToken;
                        this.user = JSON.parse(savedUser);
                        await this.loadUserData();
                        this.showGame();
                    } catch (error) {
                        console.error('Failed to load saved session:', error);
                        this.showLogin();
                    }
                } else {
                    this.showLogin();
                }
            }
            
            initializeGoogleAuth() {
                window.google.accounts.id.initialize({
                    client_id: CLIENT_ID,
                    callback: this.handleCredentialResponse.bind(this),
                    auto_select: false,
                    cancel_on_tap_outside: false
                });
                
                window.google.accounts.id.renderButton(
                    document.getElementById('gsi-button'),
                    {
                        theme: 'filled_blue',
                        size: 'large',
                        text: 'signin_with',
                        shape: 'pill',
                        locale: 'ar'
                    }
                );
            }
            
            async handleCredentialResponse(response) {
                try {
                    const decodedToken = this.parseJwt(response.credential);
                    
                    this.user = {
                        id: decodedToken.sub,
                        name: decodedToken.name,
                        email: decodedToken.email,
                        picture: decodedToken.picture
                    };
                    
                    this.token = response.credential;
                    
                    localStorage.setItem('google_token', this.token);
                    localStorage.setItem('google_user', JSON.stringify(this.user));
                    
                    await this.loadUserData();
                    this.showGame();
                    this.showToast('‚úÖ ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ÿ®ŸÜÿ¨ÿßÿ≠', 'success');
                    
                } catch (error) {
                    console.error('Login error:', error);
                    this.showToast('‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ', 'error');
                }
            }
            
            parseJwt(token) {
                const base64Url = token.split('.')[1];
                const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
                const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
                    return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
                }).join(''));
                
                return JSON.parse(jsonPayload);
            }
            
            async loadUserData() {
                try {
                    const userData = await this.apiRequest('getUser', {
                        userId: this.user.id,
                        token: this.token
                    });
                    
                    if (userData.success) {
                        this.balance = userData.balance || 0;
                        this.totalSpins = userData.totalSpins || 0;
                        this.totalWins = userData.totalWins || 0;
                        this.totalWon = userData.totalWon || 0;
                        this.biggestWin = userData.biggestWin || 0;
                        this.updateUI();
                    } else {
                        // ÿ•ŸÜÿ¥ÿßÿ° ÿ≠ÿ≥ÿßÿ® ÿ¨ÿØŸäÿØ
                        await this.createUserAccount();
                    }
                } catch (error) {
                    console.error('Error loading user data:', error);
                    // ÿ•ŸÜÿ¥ÿßÿ° ÿ≠ÿ≥ÿßÿ® ÿ¨ÿØŸäÿØ ŸÅŸä ÿ≠ÿßŸÑÿ© ÿßŸÑÿÆÿ∑ÿ£
                    await this.createUserAccount();
                }
            }
            
            async createUserAccount() {
                const userData = {
                    userId: this.user.id,
                    name: this.user.name,
                    email: this.user.email,
                    balance: 0,
                    totalSpins: 0,
                    totalWins: 0,
                    totalWon: 0,
                    biggestWin: 0
                };
                
                await this.apiRequest('createUser', userData);
                this.balance = 0;
                this.updateUI();
            }
            
            showLogin() {
                this.elements.loginScreen.style.display = 'flex';
                this.elements.gameContainer.style.display = 'none';
            }
            
            showGame() {
                this.elements.loginScreen.style.display = 'none';
                this.elements.gameContainer.style.display = 'flex';
                
                // ÿπÿ±ÿ∂ ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
                this.elements.userAvatar.textContent = this.user.name.charAt(0).toUpperCase();
                this.elements.userName.textContent = this.user.name;
                this.elements.userInfo.style.display = 'flex';
                this.elements.logoutBtn.style.display = 'block';
                
                this.updateUI();
            }
            
            logout() {
                localStorage.removeItem('google_token');
                localStorage.removeItem('google_user');
                this.user = null;
                this.token = null;
                this.showLogin();
                this.showToast('üëã ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨', 'info');
            }
            
            createGrid() {
                this.elements.reels.innerHTML = '';
                
                for (let col = 0; col < 5; col++) {
                    const column = document.createElement('div');
                    column.className = 'reel-column';
                    
                    for (let row = 0; row < 3; row++) {
                        const cell = document.createElement('div');
                        cell.className = 'reel-cell';
                        cell.dataset.row = row;
                        cell.dataset.col = col;
                        
                        const randomSymbol = SYMBOLS[Math.floor(Math.random() * SYMBOLS.length)];
                        const symbolSpan = document.createElement('span');
                        symbolSpan.className = 'symbol';
                        symbolSpan.textContent = randomSymbol.icon;
                        symbolSpan.style.color = randomSymbol.color;
                        
                        cell.appendChild(symbolSpan);
                        column.appendChild(cell);
                        this.grid[row][col] = randomSymbol.id;
                    }
                    
                    this.elements.reels.appendChild(column);
                }
            }
            
            setupEventListeners() {
                this.elements.spinBtn.addEventListener('click', () => this.spin());
                this.elements.stopBtn.addEventListener('click', () => this.stop());
                this.elements.closeWin.addEventListener('click', () => this.closeWinDisplay());
                this.elements.logoutBtn.addEventListener('click', () => this.logout());
                
                document.querySelectorAll('.btn-bet').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const bet = parseInt(e.target.dataset.bet);
                        this.setBet(bet);
                        this.playSound('click');
                    });
                });
                
                document.addEventListener('keydown', (e) => {
                    if (e.code === 'Space') {
                        e.preventDefault();
                        if (this.isSpinning) {
                            this.stop();
                        } else {
                            this.spin();
                        }
                    }
                    
                    // ÿßÿÆÿ™ÿµÿßÿ±ÿßÿ™ ÿßŸÑÿ±ŸáÿßŸÜ
                    if (e.key >= '1' && e.key <= '6' && !this.isSpinning) {
                        const betIndex = parseInt(e.key) - 1;
                        if (betIndex < BET_OPTIONS.length) {
                            this.setBet(BET_OPTIONS[betIndex]);
                            this.playSound('click');
                        }
                    }
                });
            }
            
            setBet(bet) {
                if (this.isSpinning) return;
                
                this.currentBet = bet;
                this.currentStore = this.stores[bet];
                
                document.querySelectorAll('.btn-bet').forEach(btn => {
                    const btnBet = parseInt(btn.dataset.bet);
                    if (btnBet === bet) {
                        btn.classList.add('active');
                    } else {
                        btn.classList.remove('active');
                    }
                });
                
                this.elements.currentBet.textContent = bet.toLocaleString();
                this.playSound('click');
            }
            
            async spin() {
                if (!this.isAuthenticated) {
                    this.showToast('‚ö†Ô∏è Ÿäÿ±ÿ¨Ÿâ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ÿ£ŸàŸÑÿßŸã', 'warning');
                    return;
                }
                
                if (this.isSpinning) return;
                
                if (this.balance < this.currentBet) {
                    this.showToast('üí∞ ÿ±ÿµŸäÿØŸÉ ÿ∫Ÿäÿ± ŸÉÿßŸÅŸä!', 'error');
                    return;
                }
                
                // ÿÆÿµŸÖ ÿßŸÑÿ±ŸáÿßŸÜ ŸÖŸÜ ÿßŸÑÿ±ÿµŸäÿØ
                this.balance -= this.currentBet;
                this.totalSpins++;
                this.consecutiveLosses++;
                
                // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÖÿÆÿ≤ŸÜ ÿßŸÑÿ≠ÿßŸÑŸä
                this.currentStore.currentBalance += this.currentBet * 0.8; // 80% ŸÑŸÑŸÖÿÆÿ≤ŸÜ
                
                this.isSpinning = true;
                this.elements.spinBtn.disabled = true;
                this.elements.stopBtn.disabled = false;
                
                this.playSound('spin');
                this.animateSpin();
                this.generateResults();
                
                // ÿ•ŸäŸÇÿßŸÅ ÿ™ŸÑŸÇÿßÿ¶Ÿä ÿ®ÿπÿØ 3 ÿ´ŸàÿßŸÜŸä
                setTimeout(() => {
                    if (this.isSpinning) {
                        this.stop();
                    }
                }, 3000);
                
                this.updateUI();
                await this.saveGameData();
            }
            
            animateSpin() {
                const cells = document.querySelectorAll('.reel-cell');
                cells.forEach(cell => {
                    cell.classList.add('spinning');
                    
                    const interval = setInterval(() => {
                        const randomSymbol = SYMBOLS[Math.floor(Math.random() * SYMBOLS.length)];
                        const symbolSpan = cell.querySelector('.symbol');
                        symbolSpan.textContent = randomSymbol.icon;
                        symbolSpan.style.color = randomSymbol.color;
                    }, 60);
                    
                    cell.dataset.interval = interval;
                });
            }
            
            generateResults() {
                // ÿ≠ÿ≥ÿßÿ® ÿßÿ≠ÿ™ŸÖÿßŸÑŸäÿ© ÿßŸÑŸÅŸàÿ≤ ÿ®ŸÜÿßÿ°Ÿã ÿπŸÑŸâ ÿ≠ÿßŸÑÿ© ÿßŸÑŸÖÿÆÿ≤ŸÜ
                const storeRatio = this.currentStore.currentBalance / this.currentStore.minBalance;
                let winProbability = 0.3; // 30% ÿ£ÿ≥ÿßÿ≥Ÿäÿ©
                
                if (storeRatio > 10) {
                    winProbability = 0.5; // 50% ÿ•ÿ∞ÿß ÿßŸÑŸÖÿÆÿ≤ŸÜ ŸÖŸÖÿ™ŸÑÿ¶
                } else if (storeRatio > 5) {
                    winProbability = 0.4; // 40%
                } else if (storeRatio < 2) {
                    winProbability = 0.2; // 20% ÿ•ÿ∞ÿß ÿßŸÑŸÖÿÆÿ≤ŸÜ ŸÖŸÜÿÆŸÅÿ∂
                }
                
                // ÿ≤ŸäÿßÿØÿ© ÿßŸÑÿßÿ≠ÿ™ŸÖÿßŸÑŸäÿ© ÿ®ÿπÿØ ÿßŸÑÿÆÿ≥ÿßÿ¶ÿ± ÿßŸÑŸÖÿ™ÿ™ÿßŸÑŸäÿ©
                winProbability += (this.consecutiveLosses * 0.05);
                winProbability = Math.min(winProbability, 0.7); // ÿ≠ÿØ ÿ£ŸÇÿµŸâ 70%
                
                const shouldWin = Math.random() < winProbability;
                
                if (shouldWin) {
                    this.createWinningPattern();
                } else {
                    this.createRandomPattern();
                }
                
                // ŸÅŸàÿ≤ ŸÖÿ∂ŸÖŸàŸÜ ÿ®ÿπÿØ 15 ÿÆÿ≥ÿßÿ±ÿ© ŸÖÿ™ÿ™ÿßŸÑŸäÿ©
                if (this.consecutiveLosses >= 15) {
                    this.createGuaranteedWin();
                    this.consecutiveLosses = 0;
                }
            }
            
            createWinningPattern() {
                const winType = this.determineWinType();
                const symbol = SYMBOLS[Math.floor(Math.random() * 6)]; // ÿ±ŸÖŸàÿ≤ ÿπÿßŸÑŸäÿ© ÿßŸÑŸÇŸäŸÖÿ©
                
                if (winType === 'small') {
                    // ŸÅŸàÿ≤ ÿµÿ∫Ÿäÿ±: 3 ÿ±ŸÖŸàÿ≤ ŸÖÿ™ÿ™ÿßŸÑŸäÿ©
                    const row = Math.floor(Math.random() * 3);
                    for (let col = 0; col < 3; col++) {
                        this.grid[row][col] = symbol.id;
                    }
                } else if (winType === 'medium') {
                    // ŸÅŸàÿ≤ ŸÖÿ™Ÿàÿ≥ÿ∑: 4 ÿ±ŸÖŸàÿ≤ ŸÖÿ™ÿ™ÿßŸÑŸäÿ©
                    const row = Math.floor(Math.random() * 3);
                    for (let col = 0; col < 4; col++) {
                        this.grid[row][col] = symbol.id;
                    }
                } else {
                    // ŸÅŸàÿ≤ ŸÉÿ®Ÿäÿ±: 5 ÿ±ŸÖŸàÿ≤ ŸÖÿ™ÿ™ÿßŸÑŸäÿ© ÿ£Ÿà ÿ¥ŸÉŸÑ V
                    if (Math.random() < 0.5) {
                        const row = Math.floor(Math.random() * 3);
                        for (let col = 0; col < 5; col++) {
                            this.grid[row][col] = symbol.id;
                        }
                    } else {
                        // ÿ¥ŸÉŸÑ V
                        const positions = [[0,0], [1,1], [2,2], [1,3], [0,4]];
                        positions.forEach(([r, c]) => {
                            this.grid[r][c] = symbol.id;
                        });
                    }
                }
            }
            
            determineWinType() {
                const storeRatio = this.currentStore.currentBalance / this.currentStore.minBalance;
                const random = Math.random();
                
                if (storeRatio > 8 && random < 0.3) {
                    return 'large';
                } else if (storeRatio > 4 && random < 0.5) {
                    return 'medium';
                } else {
                    return 'small';
                }
            }
            
            createRandomPattern() {
                for (let row = 0; row < 3; row++) {
                    for (let col = 0; col < 5; col++) {
                        this.grid[row][col] = SYMBOLS[Math.floor(Math.random() * SYMBOLS.length)].id;
                    }
                }
            }
            
            createGuaranteedWin() {
                const symbol = SYMBOLS[Math.floor(Math.random() * 12)];
                const row = Math.floor(Math.random() * 3);
                
                for (let col = 0; col < 3; col++) {
                    this.grid[row][col] = symbol.id;
                }
                
                this.showToast('üçÄ ÿ≠ÿ∏ÿßŸã ÿ£ŸÅÿ∂ŸÑ Ÿáÿ∞Ÿá ÿßŸÑŸÖÿ±ÿ©!', 'warning');
            }
            
            async stop() {
                if (!this.isSpinning) return;
                
                this.isSpinning = false;
                this.elements.spinBtn.disabled = false;
                this.elements.stopBtn.disabled = true;
                
                const cells = document.querySelectorAll('.reel-cell');
                cells.forEach(cell => {
                    cell.classList.remove('spinning');
                    clearInterval(cell.dataset.interval);
                });
                
                this.playSound('stop');
                this.showResults();
                
                setTimeout(async () => {
                    const results = this.checkWins();
                    await this.processResults(results);
                }, 700);
            }
            
            showResults() {
                const cells = document.querySelectorAll('.reel-cell');
                
                cells.forEach((cell, index) => {
                    const row = Math.floor(index / 5);
                    const col = index % 5;
                    const symbolId = this.grid[row][col];
                    const symbol = SYMBOLS.find(s => s.id === symbolId);
                    
                    if (symbol) {
                        const symbolSpan = cell.querySelector('.symbol');
                        symbolSpan.textContent = symbol.icon;
                        symbolSpan.style.color = symbol.color;
                    }
                });
            }
            
            checkWins() {
                const results = {
                    wins: [],
                    totalMultiplier: 0,
                    totalWin: 0,
                    winningSymbol: null
                };
                
                // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑÿµŸÅŸàŸÅ ÿßŸÑÿ£ŸÅŸÇŸäÿ©
                for (let row = 0; row < 3; row++) {
                    const line = this.grid[row];
                    let count = 1;
                    let currentSymbol = line[0];
                    
                    for (let col = 1; col < 5; col++) {
                        if (line[col] === currentSymbol) {
                            count++;
                        } else {
                            break;
                        }
                    }
                    
                    if (count >= 3) {
                        const symbol = SYMBOLS.find(s => s.id === currentSymbol);
                        const baseMultiplier = symbol.multiplier;
                        const multiplier = this.calculateWinMultiplier(count, baseMultiplier);
                        
                        results.wins.push({
                            type: 'horizontal',
                            row: row,
                            count: count,
                            symbol: currentSymbol,
                            multiplier: multiplier
                        });
                        
                        results.totalMultiplier += multiplier;
                        results.winningSymbol = currentSymbol;
                    }
                }
                
                // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿ¥ŸÉŸÑ V
                const vPositions = [[0,0], [1,1], [2,2], [1,3], [0,4]];
                const vSymbols = vPositions.map(([r, c]) => this.grid[r][c]);
                const isV = vSymbols.every(s => s === vSymbols[0]);
                
                if (isV) {
                    const symbol = SYMBOLS.find(s => s.id === vSymbols[0]);
                    const multiplier = symbol.multiplier * 20;
                    
                    results.wins.push({
                        type: 'v-shape',
                        count: 5,
                        symbol: vSymbols[0],
                        multiplier: multiplier
                    });
                    
                    results.totalMultiplier += multiplier;
                    results.winningSymbol = vSymbols[0];
                }
                
                // ÿ≠ÿ≥ÿßÿ® ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑŸÅŸàÿ≤
                results.totalWin = this.currentBet * results.totalMultiplier;
                
                return results;
            }
            
            calculateWinMultiplier(count, baseMultiplier) {
                if (count === 3) return baseMultiplier;
                if (count === 4) return baseMultiplier * 3;
                if (count === 5) return baseMultiplier * 10;
                return baseMultiplier;
            }
            
            async processResults(results) {
                this.highlightWins(results);
                
                if (results.totalWin > 0) {
                    this.consecutiveLosses = 0;
                    this.totalWins++;
                    this.totalWon += results.totalWin;
                    this.balance += results.totalWin;
                    
                    if (results.totalWin > this.biggestWin) {
                        this.biggestWin = results.totalWin;
                    }
                    
                    // ÿÆÿµŸÖ ÿßŸÑŸÖŸÉÿßÿ≥ÿ® ŸÖŸÜ ÿßŸÑŸÖÿÆÿ≤ŸÜ ŸÖÿπ ÿßŸÑÿ≠ŸÅÿßÿ∏ ÿπŸÑŸâ ÿßŸÑÿ≠ÿØ ÿßŸÑÿ£ÿØŸÜŸâ
                    const payout = Math.min(results.totalWin, this.currentStore.currentBalance - this.currentStore.minBalance);
                    this.currentStore.currentBalance -= payout;
                    
                    const winSize = this.determineWinSize(results.totalWin);
                    this.showWinDisplay(results.totalWin, results.totalMultiplier, winSize);
                    
                    if (winSize === 'mega') {
                        this.playSound('bigWin');
                        this.showToast(`üéä ŸÅŸàÿ≤ ÿ∂ÿÆŸÖ! ${results.totalWin.toLocaleString()}`, 'success');
                    } else if (winSize === 'big') {
                        this.playSound('win');
                        this.showToast(`üéâ ŸÅŸàÿ≤! ${results.totalWin.toLocaleString()}`, 'success');
                    } else {
                        this.playSound('win');
                    }
                    
                    this.lastGameResult = results;
                    
                } else {
                    const nearWins = this.checkNearWins();
                    if (nearWins > 0) {
                        this.showToast('‚ö° ŸÉÿßÿØÿ™ ÿ£ŸÜ ÿ™ŸÅŸàÿ≤!', 'warning');
                    }
                }
                
                this.updateUI();
                await this.saveGameData();
            }
            
            determineWinSize(winAmount) {
                const ratio = winAmount / this.currentBet;
                
                if (ratio >= 50) return 'mega';
                if (ratio >= 15) return 'big';
                return 'normal';
            }
            
            highlightWins(results) {
                document.querySelectorAll('.reel-cell').forEach(cell => {
                    cell.classList.remove('matched');
                });
                
                results.wins.forEach(win => {
                    if (win.type === 'horizontal') {
                        for (let col = 0; col < win.count; col++) {
                            const cell = document.querySelector(
                                `.reel-cell[data-row="${win.row}"][data-col="${col}"]`
                            );
                            if (cell) {
                                cell.classList.add('matched');
                            }
                        }
                    } else if (win.type === 'v-shape') {
                        const positions = [[0,0], [1,1], [2,2], [1,3], [0,4]];
                        positions.forEach(([row, col]) => {
                            const cell = document.querySelector(
                                `.reel-cell[data-row="${row}"][data-col="${col}"]`
                            );
                            if (cell) {
                                cell.classList.add('matched');
                            }
                        });
                    }
                });
            }
            
            checkNearWins() {
                let nearWins = 0;
                for (let row = 0; row < 3; row++) {
                    for (let col = 0; col < 4; col++) {
                        if (this.grid[row][col] === this.grid[row][col + 1]) {
                            nearWins++;
                        }
                    }
                }
                return nearWins;
            }
            
            showWinDisplay(amount, multiplier, winSize = 'normal') {
                this.elements.winAmount.textContent = amount.toLocaleString();
                this.elements.winMultiplier.textContent = `√ó${multiplier}`;
                
                if (winSize === 'mega') {
                    this.elements.winTitle.textContent = 'üéä ŸÅŸàÿ≤ ÿ∂ÿÆŸÖ! üéä';
                    this.elements.winDisplay.className = 'win-display mega-win';
                } else if (winSize === 'big') {
                    this.elements.winTitle.textContent = 'üéâ ŸÅŸàÿ≤ ŸÉÿ®Ÿäÿ±! üéâ';
                    this.elements.winDisplay.className = 'win-display big-win';
                } else {
                    this.elements.winTitle.textContent = 'üéØ ŸÅŸàÿ≤! üéØ';
                    this.elements.winDisplay.className = 'win-display normal-win';
                }
                
                this.elements.winDisplay.classList.add('active');
            }
            
            closeWinDisplay() {
                this.elements.winDisplay.classList.remove('active');
                this.playSound('click');
            }
            
            // ===== API METHODS =====
            async apiRequest(action, data = {}) {
                try {
                    const formData = new FormData();
                    formData.append('action', action);
                    formData.append('data', JSON.stringify({
                        ...data,
                        timestamp: Date.now()
                    }));
                    
                    const response = await fetch(API_URL, {
                        method: 'POST',
                        body: formData
                    });
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    const result = await response.json();
                    return result;
                    
                } catch (error) {
                    console.error('API request failed:', error);
                    throw error;
                }
            }
            
            async saveGameData() {
                if (!this.user || !this.token) return;
                
                try {
                    const gameData = {
                        userId: this.user.id,
                        token: this.token,
                        balance: this.balance,
                        totalSpins: this.totalSpins,
                        totalWins: this.totalWins,
                        totalWon: this.totalWon,
                        biggestWin: this.biggestWin,
                        lastPlayed: new Date().toISOString()
                    };
                    
                    await this.apiRequest('updateUser', gameData);
                    
                } catch (error) {
                    console.error('Error saving game data:', error);
                    this.showToast('‚ö†Ô∏è ŸÅÿ¥ŸÑ ÿ≠ŸÅÿ∏ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ÿå Ÿäÿ±ÿ¨Ÿâ ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ© ŸÑÿßÿ≠ŸÇÿßŸã', 'warning');
                }
            }
            
            // ===== AUDIO =====
            playSound(soundName) {
                if (!this.soundEnabled || !this.audio[soundName]) return;
                
                try {
                    const sound = this.audio[soundName].cloneNode();
                    sound.volume = soundName === 'win' || soundName === 'bigWin' ? 0.7 : 0.5;
                    sound.play().catch(() => {});
                } catch (error) {
                    console.warn('Error playing sound:', error);
                }
            }
            
            // ===== UI =====
            updateUI() {
                this.elements.balance.textContent = this.balance.toLocaleString();
            }
            
            showToast(message, type = 'info', duration = 3000) {
                const toast = this.elements.toast;
                const icon = toast.querySelector('.toast-icon');
                const messageEl = toast.querySelector('.toast-message');
                
                messageEl.textContent = message;
                
                toast.className = 'toast';
                if (type === 'error') {
                    toast.classList.add('error');
                    icon.textContent = '‚ùå';
                } else if (type === 'warning') {
                    toast.classList.add('warning');
                    icon.textContent = '‚ö†Ô∏è';
                } else if (type === 'success') {
                    toast.classList.add('success');
                    icon.textContent = '‚úÖ';
                } else {
                    toast.classList.add('info');
                    icon.textContent = '‚ÑπÔ∏è';
                }
                
                toast.classList.add('show');
                
                clearTimeout(this.toastTimeout);
                this.toastTimeout = setTimeout(() => {
                    toast.classList.remove('show');
                }, duration);
            }
        }

        // ===== INITIALIZE GAME =====
        window.addEventListener('DOMContentLoaded', () => {
            window.slotGame = new SlotGame();
            window.slotGame.init();
        });
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üé∞ Slot Machine Pro - ÿßŸÑÿπÿ®ÿ© ÿßŸÑÿ≥ŸÑŸàÿ™ ÿßŸÑÿßÿ≠ÿ™ÿ±ÿßŸÅŸäÿ©</title>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Image Symbols -->
    <style>
        /* ===== SYMBOL IMAGES ===== */
        @font-face {
            font-family: 'SlotSymbols';
            src: url('https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/webfonts/fa-solid-900.woff2') format('woff2');
        }
        
        .symbol-img {
            width: 70px;
            height: 70px;
            object-fit: contain;
            filter: drop-shadow(0 3px 5px rgba(0,0,0,0.3));
            transition: all 0.3s ease;
        }
        
        @media (max-width: 768px) {
            .symbol-img {
                width: 50px;
                height: 50px;
            }
        }
        
        @media (max-width: 480px) {
            .symbol-img {
                width: 40px;
                height: 40px;
            }
        }
    </style>
    
    <style>
        /* ===== RESET & BASE STYLES ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* ÿßŸÑÿ£ŸÑŸàÿßŸÜ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ© */
            --primary: #8B5CF6;
            --primary-dark: #7C3AED;
            --primary-light: #A78BFA;
            --secondary: #EC4899;
            --secondary-dark: #DB2777;
            --accent: #10B981;
            --accent-dark: #059669;
            --danger: #EF4444;
            --danger-dark: #DC2626;
            --warning: #F59E0B;
            --warning-dark: #D97706;
            --info: #3B82F6;
            --dark: #1F2937;
            --darker: #111827;
            --darkest: #0B1121;
            --light: #F3F4F6;
            --lighter: #F9FAFB;
            --gray: #6B7280;
            --gray-light: #9CA3AF;
            --gray-dark: #4B5563;
            
            /* ÿ£ŸÑŸàÿßŸÜ ÿßŸÑŸÖÿÆÿßÿ≤ŸÜ */
            --store-normal: #3B82F6;
            --store-medium: #8B5CF6;
            --store-high: #EC4899;
            --store-mega: #F59E0B;
            
            /* ÿßŸÑÿ∏ŸÑÿßŸÑ */
            --shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            --shadow-light: 0 5px 15px rgba(0, 0, 0, 0.2);
            --shadow-dark: 0 15px 35px rgba(0, 0, 0, 0.4);
            --shadow-inset: inset 0 2px 5px rgba(0, 0, 0, 0.2);
            --shadow-glow: 0 0 20px rgba(139, 92, 246, 0.5);
            
            /* ÿßŸÑÿ≤ŸàÿßŸäÿß */
            --radius: 20px;
            --radius-sm: 12px;
            --radius-lg: 28px;
            --radius-xl: 36px;
            --radius-full: 9999px;
            
            /* ÿßŸÑÿßŸÜÿ™ŸÇÿßŸÑÿßÿ™ */
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            
            /* ÿßŸÑÿ≠ÿ¨ŸÖ ÿßŸÑŸÇÿßÿ®ŸÑ ŸÑŸÑÿ™ÿπÿØŸäŸÑ ŸÑŸÑŸÅŸäÿ¥ÿßÿ™ */
            --reel-size: 320px;
            --symbol-size: 80px;
        }

        body {
            font-family: 'Tajawal', sans-serif;
            background: linear-gradient(135deg, var(--darker) 0%, var(--darkest) 100%);
            color: var(--light);
            min-height: 100vh;
            padding: 20px;
            direction: rtl;
            overflow-x: hidden;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 10% 20%, rgba(139, 92, 246, 0.15) 0%, transparent 40%),
                radial-gradient(circle at 90% 80%, rgba(236, 72, 153, 0.15) 0%, transparent 40%),
                radial-gradient(circle at 50% 50%, rgba(16, 185, 129, 0.1) 0%, transparent 50%),
                url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect width="100" height="100" fill="transparent"/><path d="M0,50 Q25,25 50,50 T100,50" stroke="rgba(255,255,255,0.02)" fill="none" stroke-width="1"/></svg>');
            z-index: -1;
            pointer-events: none;
        }

        /* ===== CONTAINER ===== */
        .container {
            max-width: 1800px;
            margin: 0 auto;
            position: relative;
            padding: 0 20px;
        }

        /* ===== HEADER ===== */
        .header {
            background: linear-gradient(135deg, rgba(31, 41, 55, 0.95), rgba(17, 24, 39, 0.95));
            backdrop-filter: blur(20px);
            border-radius: var(--radius);
            padding: 25px 40px;
            margin-bottom: 40px;
            border: 2px solid rgba(139, 92, 246, 0.4);
            box-shadow: var(--shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 25px;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--secondary), var(--accent));
            z-index: 1;
        }

        .player-info {
            display: flex;
            align-items: center;
            gap: 25px;
            flex-wrap: wrap;
        }

        .balance-container {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            padding: 18px 35px;
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            gap: 18px;
            box-shadow: var(--shadow);
            border: 2px solid rgba(255, 255, 255, 0.2);
            min-width: 250px;
            position: relative;
            overflow: hidden;
        }

        .balance-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.1) 50%, transparent 70%);
            transform: translateX(-100%);
            animation: shine 3s infinite;
        }

        @keyframes shine {
            100% { transform: translateX(100%); }
        }

        .balance-icon {
            font-size: 2.5em;
            filter: drop-shadow(0 3px 5px rgba(0,0,0,0.3));
        }

        .balance-amount {
            font-size: 2.8em;
            font-weight: 900;
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        .player-id {
            background: rgba(255, 255, 255, 0.12);
            padding: 12px 24px;
            border-radius: var(--radius-sm);
            font-size: 1.1em;
            color: var(--light);
            border: 1px solid rgba(255, 255, 255, 0.15);
            font-family: monospace;
            backdrop-filter: blur(10px);
        }

        .game-title {
            text-align: center;
            flex-grow: 1;
            position: relative;
        }

        .game-title h1 {
            background: linear-gradient(135deg, var(--primary), var(--secondary), var(--accent));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-size: 3.2em;
            font-weight: 900;
            margin-bottom: 8px;
            text-shadow: 0 2px 15px rgba(139, 92, 246, 0.4);
            letter-spacing: -0.5px;
        }

        .game-title p {
            color: var(--gray-light);
            font-size: 1.3em;
            background: rgba(255, 255, 255, 0.05);
            display: inline-block;
            padding: 8px 20px;
            border-radius: var(--radius-full);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .controls-header {
            display: flex;
            gap: 15px;
        }

        /* ===== GAME AREA ===== */
        .game-area {
            display: grid;
            grid-template-columns: 1fr 500px;
            gap: 40px;
            margin-bottom: 40px;
        }

        @media (max-width: 1400px) {
            .game-area {
                grid-template-columns: 1fr;
            }
        }

        /* ===== SLOT MACHINE ===== */
        .slot-machine {
            background: linear-gradient(135deg, rgba(31, 41, 55, 0.95), rgba(17, 24, 39, 0.95));
            backdrop-filter: blur(20px);
            border-radius: var(--radius);
            padding: 40px;
            box-shadow: var(--shadow);
            border: 3px solid rgba(139, 92, 246, 0.4);
            position: relative;
            overflow: hidden;
        }

        .slot-machine::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                linear-gradient(45deg, transparent 40%, rgba(255,255,255,0.03) 50%, transparent 60%),
                radial-gradient(circle at 20% 30%, rgba(139, 92, 246, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(236, 72, 153, 0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: 1;
        }

        .slot-frame {
            background: linear-gradient(145deg, #1a202c, #2d3748);
            border-radius: var(--radius);
            padding: 30px;
            border: 4px solid rgba(236, 72, 153, 0.4);
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
            box-shadow: 
                inset 0 0 40px rgba(0, 0, 0, 0.6),
                0 10px 30px rgba(0, 0, 0, 0.4);
        }

        .slot-frame::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 8px;
            background: linear-gradient(90deg, var(--primary), var(--secondary), var(--accent));
            z-index: 2;
        }

        .slot-frame::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 8px;
            background: linear-gradient(90deg, var(--accent), var(--secondary), var(--primary));
            z-index: 2;
        }

        .reels-container {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 20px;
            height: calc(var(--reel-size) * 3 / 5);
            min-height: 350px;
            position: relative;
            z-index: 2;
        }

        .reel-cell {
            background: linear-gradient(145deg, #2d3748, #1f2937);
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            transition: var(--transition);
            box-shadow: 
                inset 0 4px 8px rgba(0, 0, 0, 0.4),
                0 4px 12px rgba(0, 0, 0, 0.3);
            border: 3px solid rgba(255, 255, 255, 0.08);
            overflow: hidden;
            transform-style: preserve-3d;
        }

        .reel-cell::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255,255,255,0.08), transparent 60%);
            pointer-events: none;
        }

        .reel-cell.spinning {
            animation: spinReel 0.12s linear infinite;
            background: linear-gradient(145deg, #3b4252, #2d3748);
            box-shadow: 
                inset 0 0 20px rgba(139, 92, 246, 0.3),
                0 0 30px rgba(139, 92, 246, 0.2);
        }

        @keyframes spinReel {
            0% { transform: translateY(0) rotateX(0); }
            25% { transform: translateY(-30px) rotateX(20deg); }
            50% { transform: translateY(-60px) rotateX(0); }
            75% { transform: translateY(-90px) rotateX(-20deg); }
            100% { transform: translateY(-120px) rotateX(0); }
        }

        .reel-cell.matched {
            animation: pulseGlow 0.6s ease infinite alternate;
            border-color: var(--accent);
            box-shadow: 
                0 0 40px var(--accent),
                inset 0 0 30px rgba(16, 185, 129, 0.4);
            z-index: 10;
            transform: scale(1.05);
        }

        @keyframes pulseGlow {
            0% { 
                transform: scale(1.05) rotateY(0);
                box-shadow: 0 0 30px var(--accent), inset 0 0 20px rgba(16, 185, 129, 0.3);
            }
            100% { 
                transform: scale(1.12) rotateY(8deg);
                box-shadow: 0 0 60px var(--accent), inset 0 0 40px rgba(16, 185, 129, 0.5);
            }
        }

        .reel-cell.mega-win {
            animation: megaWin 1s ease infinite;
            border-color: #FBBF24;
            box-shadow: 0 0 70px #FBBF24, inset 0 0 50px rgba(251, 191, 36, 0.5);
        }

        @keyframes megaWin {
            0%, 100% { transform: scale(1.05); }
            50% { transform: scale(1.15); }
        }

        /* ===== CONTROL PANEL ===== */
        .control-panel {
            background: linear-gradient(135deg, rgba(31, 41, 55, 0.95), rgba(17, 24, 39, 0.95));
            backdrop-filter: blur(20px);
            border-radius: var(--radius);
            padding: 40px;
            box-shadow: var(--shadow);
            border: 3px solid rgba(236, 72, 153, 0.4);
            display: flex;
            flex-direction: column;
            gap: 35px;
        }

        .section-title {
            color: var(--light);
            font-size: 1.5em;
            font-weight: 800;
            margin-bottom: 25px;
            text-align: center;
            position: relative;
            padding-bottom: 15px;
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            right: 30%;
            left: 30%;
            height: 4px;
            background: linear-gradient(90deg, transparent, var(--accent), transparent);
            border-radius: 2px;
        }

        .bet-controls {
            background: rgba(0, 0, 0, 0.5);
            border-radius: var(--radius);
            padding: 30px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
        }

        .bet-controls::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
        }

        .bet-display {
            text-align: center;
            margin-bottom: 30px;
        }

        .bet-amount {
            font-size: 4.2em;
            font-weight: 900;
            color: var(--accent);
            text-shadow: 0 0 25px rgba(16, 185, 129, 0.6);
            background: linear-gradient(135deg, var(--accent), #22D3EE);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .bet-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 25px;
        }

        .spin-controls {
            display: flex;
            gap: 20px;
            margin-top: 15px;
        }

        .btn {
            border: none;
            border-radius: var(--radius-sm);
            font-family: 'Tajawal', sans-serif;
            font-size: 1.3em;
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            padding: 20px;
            position: relative;
            overflow: hidden;
            transform-style: preserve-3d;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.15) 50%, transparent 70%);
            transform: translateX(-100%);
            transition: transform 0.6s;
        }

        .btn:hover:not(:disabled)::before {
            transform: translateX(100%);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            flex: 2;
            box-shadow: 0 8px 30px rgba(139, 92, 246, 0.4);
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 15px 40px rgba(139, 92, 246, 0.6);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger), var(--danger-dark));
            color: white;
            flex: 1;
            box-shadow: 0 8px 30px rgba(239, 68, 68, 0.4);
        }

        .btn-danger:hover:not(:disabled) {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 15px 40px rgba(239, 68, 68, 0.6);
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning), var(--warning-dark));
            color: white;
            box-shadow: 0 8px 30px rgba(245, 158, 11, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--accent), var(--accent-dark));
            color: white;
            box-shadow: 0 8px 30px rgba(16, 185, 129, 0.4);
        }

        .btn-info {
            background: linear-gradient(135deg, var(--info), #2563EB);
            color: white;
            box-shadow: 0 8px 30px rgba(59, 130, 246, 0.4);
        }

        .btn-bet {
            background: rgba(255, 255, 255, 0.1);
            color: var(--light);
            border: 2px solid rgba(255, 255, 255, 0.15);
            font-size: 1.2em;
            padding: 18px 12px;
            backdrop-filter: blur(10px);
        }

        .btn-bet:hover:not(.active):not(:disabled) {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-3px);
        }

        .btn-bet.active {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            box-shadow: 0 0 25px rgba(139, 92, 246, 0.5);
            border-color: var(--primary-light);
            transform: scale(1.05);
        }

        /* ===== STORES PANEL ===== */
        .stores-panel {
            background: rgba(0, 0, 0, 0.5);
            border-radius: var(--radius);
            padding: 30px;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }

        .stores-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 25px;
        }

        .store-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius-sm);
            padding: 25px;
            border-left: 6px solid;
            transition: var(--transition);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.08);
            position: relative;
            overflow: hidden;
        }

        .store-card:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateX(-8px);
            border-color: rgba(255, 255, 255, 0.2);
        }

        .store-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 40%, rgba(255,255,255,0.03) 50%, transparent 60%);
            transform: translateX(-100%);
            transition: transform 0.6s;
        }

        .store-card:hover::before {
            transform: translateX(100%);
        }

        .store-card.normal { border-left-color: var(--store-normal); }
        .store-card.medium { border-left-color: var(--store-medium); }
        .store-card.high { border-left-color: var(--store-high); }
        .store-card.mega { border-left-color: var(--store-mega); }

        .store-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .store-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .store-icon {
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius-sm);
            font-size: 2em;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .store-icon.normal { 
            background: linear-gradient(135deg, var(--store-normal), #60A5FA);
            color: white;
        }
        .store-icon.medium { 
            background: linear-gradient(135deg, var(--store-medium), #A78BFA);
            color: white;
        }
        .store-icon.high { 
            background: linear-gradient(135deg, var(--store-high), #F472B6);
            color: white;
        }
        .store-icon.mega { 
            background: linear-gradient(135deg, var(--store-mega), #FBBF24);
            color: white;
        }

        .store-details h3 {
            font-size: 1.4em;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .store-details .store-type {
            font-size: 0.9em;
            color: var(--gray-light);
        }

        .store-amount {
            font-weight: 900;
            font-size: 1.8em;
        }

        .store-amount.normal { color: var(--store-normal); }
        .store-amount.medium { color: var(--store-medium); }
        .store-amount.high { color: var(--store-high); }
        .store-amount.mega { color: var(--store-mega); }

        .store-progress {
            margin-top: 15px;
        }

        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.9em;
            color: var(--gray-light);
        }

        .progress-bar {
            height: 24px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            overflow: hidden;
            position: relative;
            box-shadow: inset 0 2px 8px rgba(0,0,0,0.3);
        }

        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.15), transparent);
            transform: translateX(-100%);
            animation: shimmer 3s infinite;
        }

        .progress-fill {
            height: 100%;
            transition: width 1s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
            z-index: 1;
        }

        .progress-fill.normal { background: linear-gradient(90deg, var(--store-normal), #60A5FA); }
        .progress-fill.medium { background: linear-gradient(90deg, var(--store-medium), #A78BFA); }
        .progress-fill.high { background: linear-gradient(90deg, var(--store-high), #F472B6); }
        .progress-fill.mega { background: linear-gradient(90deg, var(--store-mega), #FBBF24); }

        .store-status {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 0.9em;
            color: var(--gray-light);
        }

        /* ===== STATS PANEL ===== */
        .stats-panel {
            background: rgba(0, 0, 0, 0.5);
            border-radius: var(--radius);
            padding: 30px;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 25px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 25px;
            border-radius: var(--radius-sm);
            text-align: center;
            transition: var(--transition);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.05);
            position: relative;
            overflow: hidden;
        }

        .stat-card:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-5px);
            border-color: rgba(255, 255, 255, 0.15);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
        }

        .stat-icon {
            font-size: 2.2em;
            margin-bottom: 15px;
            color: var(--primary-light);
            filter: drop-shadow(0 3px 5px rgba(0,0,0,0.3));
        }

        .stat-label {
            font-size: 0.95em;
            color: var(--gray-light);
            margin-bottom: 10px;
            font-weight: 500;
        }

        .stat-value {
            font-size: 1.8em;
            font-weight: 900;
            color: var(--accent);
            text-shadow: 0 2px 10px rgba(16, 185, 129, 0.3);
        }

        /* ===== WIN DISPLAY ===== */
        .win-display {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: linear-gradient(135deg, rgba(31, 41, 55, 0.98), rgba(17, 24, 39, 0.98));
            padding: 60px 80px;
            border-radius: var(--radius-xl);
            border: 6px solid;
            text-align: center;
            z-index: 2000;
            display: none;
            box-shadow: 
                var(--shadow-dark),
                0 0 80px rgba(251, 191, 36, 0.4),
                inset 0 0 40px rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(30px);
            min-width: 600px;
            max-width: 90vw;
            border-image: linear-gradient(45deg, var(--primary), var(--secondary), var(--accent)) 1;
        }

        .win-display.active {
            display: block;
            animation: winPopIn 0.8s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        @keyframes winPopIn {
            0% { 
                transform: translate(-50%, -50%) scale(0) rotate(-20deg); 
                opacity: 0; 
            }
            70% { 
                transform: translate(-50%, -50%) scale(1.15) rotate(10deg); 
                opacity: 1; 
            }
            100% { 
                transform: translate(-50%, -50%) scale(1) rotate(0); 
                opacity: 1; 
            }
        }

        .win-display.normal-win {
            border-color: var(--store-normal);
        }

        .win-display.medium-win {
            border-color: var(--store-medium);
        }

        .win-display.high-win {
            border-color: var(--store-high);
        }

        .win-display.mega-win {
            border-color: var(--store-mega);
            animation: megaWinPop 1s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        @keyframes megaWinPop {
            0% { 
                transform: translate(-50%, -50%) scale(0) rotate(-30deg); 
                opacity: 0; 
            }
            70% { 
                transform: translate(-50%, -50%) scale(1.3) rotate(15deg); 
                opacity: 1; 
            }
            100% { 
                transform: translate(-50%, -50%) scale(1) rotate(0); 
                opacity: 1; 
            }
        }

        .win-title {
            font-size: 3.2em;
            font-weight: 900;
            margin-bottom: 15px;
            background: linear-gradient(135deg, #FBBF24, #F59E0B, #DC2626);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 2px 20px rgba(251, 191, 36, 0.4);
            letter-spacing: -1px;
        }

        .win-amount {
            font-size: 6em;
            font-weight: 900;
            margin: 25px 0;
            text-shadow: 0 0 50px #FBBF24;
            animation: winAmountGlow 2s ease-in-out infinite;
            background: linear-gradient(135deg, #FBBF24, #F59E0B, #DC2626);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        @keyframes winAmountGlow {
            0%, 100% { 
                text-shadow: 
                    0 0 40px #FBBF24,
                    0 0 80px rgba(251, 191, 36, 0.6); 
            }
            50% { 
                text-shadow: 
                    0 0 60px #FBBF24,
                    0 0 120px rgba(251, 191, 36, 0.8); 
            }
        }

        .win-multiplier {
            font-size: 1.8em;
            color: var(--light);
            margin-bottom: 35px;
            background: rgba(255, 255, 255, 0.1);
            display: inline-block;
            padding: 15px 35px;
            border-radius: var(--radius-full);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .win-close {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            padding: 18px 50px;
            border-radius: var(--radius-sm);
            font-size: 1.3em;
            font-weight: 700;
            cursor: pointer;
            margin-top: 25px;
            transition: var(--transition);
            box-shadow: 0 8px 30px rgba(139, 92, 246, 0.4);
            position: relative;
            overflow: hidden;
        }

        .win-close:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 15px 40px rgba(139, 92, 246, 0.6);
        }

        .win-close::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.2) 50%, transparent 70%);
            transform: translateX(-100%);
            transition: transform 0.6s;
        }

        .win-close:hover::before {
            transform: translateX(100%);
        }

        /* ===== LOADING ===== */
        .loading {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, var(--darker) 0%, var(--darkest) 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .loading-logo {
            font-size: 5em;
            margin-bottom: 30px;
            animation: logoFloat 3s ease-in-out infinite;
            filter: drop-shadow(0 5px 15px rgba(139, 92, 246, 0.5));
        }

        @keyframes logoFloat {
            0%, 100% { transform: translateY(0) rotate(0); }
            50% { transform: translateY(-25px) rotate(8deg); }
        }

        .loading-spinner {
            width: 80px;
            height: 80px;
            border: 6px solid rgba(139, 92, 246, 0.2);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1.5s linear infinite;
            margin-bottom: 30px;
            position: relative;
        }

        .loading-spinner::before {
            content: '';
            position: absolute;
            top: -10px;
            left: -10px;
            right: -10px;
            bottom: -10px;
            border: 6px solid rgba(236, 72, 153, 0.1);
            border-radius: 50%;
        }

        .loading-spinner::after {
            content: '';
            position: absolute;
            top: -20px;
            left: -20px;
            right: -20px;
            bottom: -20px;
            border: 6px solid rgba(16, 185, 129, 0.05);
            border-radius: 50%;
        }

        .loading-message {
            color: var(--light);
            font-size: 1.4em;
            margin-top: 15px;
            text-align: center;
            max-width: 400px;
            font-weight: 500;
        }

        /* ===== CLOUD STATUS ===== */
        .cloud-status {
            position: fixed;
            top: 30px;
            left: 30px;
            background: linear-gradient(135deg, rgba(31, 41, 55, 0.95), rgba(17, 24, 39, 0.95));
            color: white;
            padding: 12px 25px;
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1em;
            z-index: 100;
            border: 2px solid transparent;
            backdrop-filter: blur(20px);
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .cloud-status.connected {
            border-color: var(--accent);
            background: linear-gradient(135deg, rgba(31, 41, 55, 0.95), rgba(17, 24, 39, 0.95));
        }

        .cloud-status.disconnected {
            border-color: var(--danger);
            background: linear-gradient(135deg, rgba(31, 41, 55, 0.95), rgba(17, 24, 39, 0.95));
        }

        .cloud-status.pending {
            border-color: var(--warning);
            background: linear-gradient(135deg, rgba(31, 41, 55, 0.95), rgba(17, 24, 39, 0.95));
        }

        /* ===== TOAST ===== */
        .toast {
            position: fixed;
            bottom: 40px;
            right: 40px;
            background: linear-gradient(135deg, rgba(31, 41, 55, 0.98), rgba(17, 24, 39, 0.98));
            color: white;
            padding: 20px 35px;
            border-radius: var(--radius);
            border-right: 6px solid;
            box-shadow: var(--shadow);
            transform: translateX(100%);
            transition: transform 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
            z-index: 1000;
            backdrop-filter: blur(20px);
            max-width: 450px;
            display: flex;
            align-items: center;
            gap: 20px;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.success {
            border-right-color: var(--accent);
        }

        .toast.error {
            border-right-color: var(--danger);
        }

        .toast.warning {
            border-right-color: var(--warning);
        }

        .toast.info {
            border-right-color: var(--info);
        }

        .toast-icon {
            font-size: 1.8em;
            flex-shrink: 0;
        }

        .toast-message {
            flex-grow: 1;
            font-size: 1.1em;
            line-height: 1.5;
        }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 1600px) {
            :root {
                --reel-size: 280px;
            }
        }

        @media (max-width: 1400px) {
            .game-area {
                grid-template-columns: 1fr;
            }
            
            .reels-container {
                height: calc(var(--reel-size) * 3 / 5);
                min-height: 300px;
            }
        }

        @media (max-width: 1200px) {
            :root {
                --reel-size: 240px;
            }
            
            .header {
                padding: 20px 30px;
            }
            
            .game-title h1 {
                font-size: 2.8em;
            }
            
            .balance-amount {
                font-size: 2.4em;
            }
        }

        @media (max-width: 992px) {
            .header {
                flex-direction: column;
                text-align: center;
                padding: 20px;
            }
            
            .player-info {
                justify-content: center;
            }
            
            .stats-grid {
                grid-template-columns: repeat(4, 1fr);
                gap: 20px;
            }
            
            .bet-buttons {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .win-display {
                min-width: 500px;
                padding: 40px 60px;
            }
            
            .win-amount {
                font-size: 4.5em;
            }
        }

        @media (max-width: 768px) {
            :root {
                --reel-size: 200px;
                --symbol-size: 60px;
            }
            
            .container {
                padding: 0 15px;
            }
            
            .slot-machine,
            .control-panel {
                padding: 25px;
            }
            
            .reels-container {
                gap: 12px;
                height: calc(var(--reel-size) * 3 / 5);
            }
            
            .balance-container {
                min-width: auto;
                padding: 15px 25px;
            }
            
            .balance-amount {
                font-size: 2.2em;
            }
            
            .game-title h1 {
                font-size: 2.3em;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .bet-buttons {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .btn {
                padding: 18px;
                font-size: 1.1em;
            }
            
            .bet-amount {
                font-size: 3.5em;
            }
            
            .store-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .store-amount {
                align-self: flex-end;
            }
            
            .win-display {
                min-width: auto;
                width: 95%;
                padding: 30px 40px;
            }
            
            .win-amount {
                font-size: 3.5em;
            }
            
            .win-title {
                font-size: 2.5em;
            }
            
            .cloud-status {
                top: 20px;
                left: 20px;
                font-size: 0.9em;
                padding: 10px 20px;
            }
        }

        @media (max-width: 576px) {
            :root {
                --reel-size: 160px;
            }
            
            body {
                padding: 10px;
            }
            
            .header {
                padding: 15px;
            }
            
            .slot-machine,
            .control-panel {
                padding: 20px;
            }
            
            .reels-container {
                gap: 8px;
                height: calc(var(--reel-size) * 3 / 5);
                min-height: 200px;
            }
            
            .balance-container {
                padding: 12px 20px;
            }
            
            .balance-amount {
                font-size: 1.8em;
            }
            
            .game-title h1 {
                font-size: 1.8em;
            }
            
            .game-title p {
                font-size: 1em;
                padding: 6px 15px;
            }
            
            .bet-buttons {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .spin-controls {
                flex-direction: column;
            }
            
            .btn {
                padding: 16px;
                font-size: 1em;
            }
            
            .store-card {
                padding: 20px;
            }
            
            .store-icon {
                width: 50px;
                height: 50px;
                font-size: 1.5em;
            }
            
            .store-details h3 {
                font-size: 1.2em;
            }
            
            .store-amount {
                font-size: 1.5em;
            }
            
            .stat-card {
                padding: 20px;
            }
            
            .stat-value {
                font-size: 1.5em;
            }
            
            .win-display {
                padding: 25px 30px;
            }
            
            .win-amount {
                font-size: 2.8em;
            }
            
            .win-title {
                font-size: 2em;
            }
            
            .win-multiplier {
                font-size: 1.4em;
                padding: 12px 25px;
            }
            
            .toast {
                bottom: 20px;
                right: 20px;
                left: 20px;
                max-width: none;
                padding: 15px 25px;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading" id="loading">
        <div class="loading-logo">üé∞</div>
        <div class="loading-spinner"></div>
        <div class="loading-message" id="loadingMessage">ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÑÿπÿ®ÿ©...</div>
    </div>

    <!-- Cloud Status -->
    <div class="cloud-status disconnected" id="cloudStatus">
        <i class="fas fa-cloud-slash"></i>
        <span>ÿ∫Ÿäÿ± ŸÖÿ™ÿµŸÑ</span>
    </div>

    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="player-info">
                <div class="balance-container">
                    <span class="balance-icon">üí∞</span>
                    <span class="balance-amount" id="balance">10,000</span>
                </div>
                <div class="player-id" id="playerId">...</div>
            </div>
            
            <div class="game-title">
                <h1>üé∞ Slot Machine Pro</h1>
                <p>ÿßŸÑÿπÿ®ÿ© ÿßŸÑÿ≥ŸÑŸàÿ™ ÿßŸÑÿßÿ≠ÿ™ÿ±ÿßŸÅŸäÿ©</p>
            </div>
            
            <div class="controls-header">
                <button class="btn btn-info" id="syncBtn" title="ŸÖÿ≤ÿßŸÖŸÜÿ© ŸÖÿπ ÿßŸÑÿ≥ÿ≠ÿßÿ®ÿ©">
                    <i class="fas fa-sync-alt"></i>
                </button>
                <button class="btn btn-warning" id="soundToggle" title="ÿ™ŸÅÿπŸäŸÑ/ÿ™ÿπÿ∑ŸäŸÑ ÿßŸÑÿµŸàÿ™">
                    <i class="fas fa-volume-up"></i>
                </button>
                <button class="btn btn-success" id="helpBtn" title="ŸÖÿ≥ÿßÿπÿØÿ©">
                    <i class="fas fa-question-circle"></i>
                </button>
            </div>
        </header>

        <!-- Game Area -->
        <div class="game-area">
            <!-- Slot Machine -->
            <div class="slot-machine">
                <div class="slot-frame">
                    <div class="reels-container" id="reels">
                        <!-- Will be filled by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Control Panel -->
            <div class="control-panel">
                <!-- Bet Controls -->
                <div class="bet-controls">
                    <div class="section-title">üéØ ÿßŸÑÿ±ŸáÿßŸÜ ÿßŸÑÿ≠ÿßŸÑŸä</div>
                    <div class="bet-display">
                        <div class="bet-amount" id="currentBet">600</div>
                    </div>
                    
                    <div class="bet-buttons">
                        <button class="btn btn-bet" data-bet="300">300</button>
                        <button class="btn btn-bet" data-bet="600">600</button>
                        <button class="btn btn-bet active" data-bet="1200">1,200</button>
                        <button class="btn btn-bet" data-bet="2400">2,400</button>
                        <button class="btn btn-bet" data-bet="4800">4,800</button>
                        <button class="btn btn-bet" data-bet="9600">9,600</button>
                    </div>
                    
                    <div class="spin-controls">
                        <button class="btn btn-primary" id="spinBtn">
                            <i class="fas fa-play"></i> ÿ™ÿØŸàŸäÿ± (Space)
                        </button>
                        <button class="btn btn-danger" id="stopBtn" disabled>
                            <i class="fas fa-stop"></i> ÿ•ŸäŸÇÿßŸÅ (Space)
                        </button>
                    </div>
                </div>

                <!-- Stores Panel -->
                <div class="stores-panel">
                    <div class="section-title">üè¶ ŸÜÿ∏ÿßŸÖ ÿßŸÑŸÖÿÆÿßÿ≤ŸÜ</div>
                    <div class="stores-grid" id="storesGrid">
                        <!-- Will be filled by JavaScript -->
                    </div>
                </div>

                <!-- Stats Panel -->
                <div class="stats-panel">
                    <div class="section-title">üìä ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿßŸÑŸÑÿπÿ®ÿ©</div>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon">üéØ</div>
                            <div class="stat-label">ÿπÿØÿØ ÿßŸÑÿØŸàÿ±ÿßÿ™</div>
                            <div class="stat-value" id="totalSpins">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">üìà</div>
                            <div class="stat-label">ŸÜÿ≥ÿ®ÿ© ÿßŸÑŸÅŸàÿ≤</div>
                            <div class="stat-value" id="winRate">0%</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">üèÜ</div>
                            <div class="stat-label">ÿ£ŸÉÿ®ÿ± ŸÅŸàÿ≤</div>
                            <div class="stat-value" id="biggestWin">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">üí∞</div>
                            <div class="stat-label">ŸÖÿπÿØŸÑ ÿßŸÑÿπÿßÿ¶ÿØ</div>
                            <div class="stat-value" id="rtpRate">96.5%</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Win Display -->
    <div class="win-display" id="winDisplay">
        <div class="win-title" id="winTitle">üéâ ŸÅŸàÿ≤ ÿ±ÿßÿ¶ÿπ!</div>
        <div class="win-amount" id="winAmount">0</div>
        <div class="win-multiplier">
            ŸÖÿ∂ÿßÿπŸÅ: <span id="winMultiplier">√ó1</span>
        </div>
        <button class="win-close" id="closeWin">ŸÖÿ™ÿßÿ®ÿπÿ© ÿßŸÑŸÑÿπÿ®</button>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast">
        <span class="toast-icon"></span>
        <span class="toast-message"></span>
    </div>

    <!-- Audio Elements -->
    <audio id="spinSound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-slot-machine-spin-1073.mp3" type="audio/mpeg">
    </audio>
    <audio id="stopSound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-arcade-game-jump-coin-216.mp3" type="audio/mpeg">
    </audio>
    <audio id="winSound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3" type="audio/mpeg">
    </audio>
    <audio id="bigWinSound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-big-win-2021.mp3" type="audio/mpeg">
    </audio>
    <audio id="clickSound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-select-click-1109.mp3" type="audio/mpeg">
    </audio>

    <!-- JavaScript -->
    <script>
        // ===== GOOGLE APPS SCRIPT API CONFIG =====
        const API_URL = 'https://script.google.com/macros/s/AKfycbxzdOGbJgp7zz2IVtnD-sbcyKpcEPSuRGMMq2fOe_0sL6vTwL3pUT2PQ0_Dg43dAxHAoQ/exec';

        // ===== GAME CONSTANTS =====
        // ÿ±ŸÖŸàÿ≤ ÿ±ÿ≥ŸàŸÖŸäÿ© ÿßÿ≠ÿ™ÿ±ÿßŸÅŸäÿ©
        const SYMBOLS = [
            { id: 'gold', name: 'ÿ≥ÿ®ŸäŸÉÿ© ÿ∞Ÿáÿ®', multiplier: 15, color: '#FBBF24', icon: 'ü•á' },
            { id: 'diamond', name: 'ÿßŸÑŸÖÿßÿ≥', multiplier: 12, color: '#3B82F6', icon: 'üíé' },
            { id: 'crown', name: 'ÿßŸÑÿ™ÿßÿ¨', multiplier: 10, color: '#8B5CF6', icon: 'üëë' },
            { id: 'seven', name: 'ÿßŸÑÿ≥ÿ®ÿπÿ©', multiplier: 20, color: '#EF4444', icon: '7Ô∏è‚É£' },
            { id: 'bar', name: 'ÿßŸÑÿ®ÿßÿ±', multiplier: 8, color: '#10B981', icon: 'üìä' },
            { id: 'bell', name: 'ÿßŸÑÿ¨ÿ±ÿ≥', multiplier: 7, color: '#EC4899', icon: 'üîî' },
            { id: 'cherry', name: 'ÿßŸÑŸÉÿ±ÿ≤', multiplier: 6, color: '#DC2626', icon: 'üçí' },
            { id: 'lemon', name: 'ÿßŸÑŸÑŸäŸÖŸàŸÜ', multiplier: 5, color: '#F59E0B', icon: 'üçã' },
            { id: 'watermelon', name: 'ÿßŸÑÿ®ÿ∑ŸäÿÆ', multiplier: 4, color: '#10B981', icon: 'üçâ' }
        ];
        
        const BET_OPTIONS = [300, 600, 1200, 2400, 4800, 9600];
        const INITIAL_BALANCE = 10000;
        
        // ===== STORES SYSTEM =====
        // ŸÜÿ∏ÿßŸÖ 4 ŸÖÿÆÿßÿ≤ŸÜ ŸÑŸÉŸÑ ŸÅŸäÿ¥ (600)
        const INITIAL_STORES = {
            normal: { 
                name: 'ÿßŸÑÿ£ÿ±ÿ®ÿßÿ≠ ÿßŸÑÿπÿßÿØŸäÿ©', 
                balance: 300000, 
                minBalance: 50000, 
                refillRate: 0.2,
                winMultiplier: { min: 1, max: 5 },
                icon: 'üí∞'
            },
            medium: { 
                name: 'ÿßŸÑÿ£ÿ±ÿ®ÿßÿ≠ ÿßŸÑŸÖÿ™Ÿàÿ≥ÿ∑ÿ©', 
                balance: 200000, 
                minBalance: 30000, 
                refillRate: 0.2,
                winMultiplier: { min: 6, max: 15 },
                icon: 'üíé'
            },
            high: { 
                name: 'ÿßŸÑÿ£ÿ±ÿ®ÿßÿ≠ ÿßŸÑÿπÿßŸÑŸäÿ©', 
                balance: 150000, 
                minBalance: 20000, 
                refillRate: 0.2,
                winMultiplier: { min: 16, max: 50 },
                icon: 'üëë'
            },
            mega: { 
                name: 'ÿßŸÑÿ£ÿ±ÿ®ÿßÿ≠ ÿßŸÑÿ∂ÿÆŸÖÿ©', 
                balance: 100000, 
                minBalance: 10000, 
                refillRate: 0.2,
                winMultiplier: { min: 51, max: 200 },
                icon: 'üèÜ'
            }
        };
        
        // 20% ŸÖŸÉÿßÿ≥ÿ® ÿßŸÑŸÖŸàŸÇÿπ (ŸÑÿß Ÿäÿ™ŸÖ ÿßŸÑÿØŸÅÿπ ŸÖŸÜŸáÿß)
        const SITE_PROFIT_PERCENTAGE = 0.2;

        // ===== GOOGLE APPS SCRIPT API SERVICE =====
        class APIService {
            constructor() {
                this.apiUrl = API_URL;
                this.playerId = localStorage.getItem('slotPlayerId') || this.generatePlayerId();
                this.pendingSync = JSON.parse(localStorage.getItem('pendingSync') || '[]');
            }

            generatePlayerId() {
                const id = 'PLAYER_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                localStorage.setItem('slotPlayerId', id);
                return id;
            }

            async makeRequest(action, params = {}) {
                try {
                    const urlParams = new URLSearchParams({
                        action: action,
                        ...params,
                        timestamp: Date.now(),
                        playerId: this.playerId
                    });
                    
                    const url = `${this.apiUrl}?${urlParams}`;
                    
                    const response = await fetch(url);
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    return data;
                    
                } catch (error) {
                    console.warn(`API request failed for ${action}:`, error);
                    return { 
                        success: false, 
                        error: error.message,
                        message: 'API connection failed'
                    };
                }
            }

            async ping() {
                return await this.makeRequest('ping');
            }

            async getStats() {
                return await this.makeRequest('getStats');
            }

            async savePlayerData(playerData) {
                try {
                    const formData = new URLSearchParams();
                    formData.append('action', 'savePlayer');
                    formData.append('playerData', JSON.stringify(playerData));
                    
                    const response = await fetch(this.apiUrl, {
                        method: 'POST',
                        body: formData
                    });
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    return await response.json();
                    
                } catch (error) {
                    console.warn('Failed to save player data:', error);
                    this.addToPendingSync('player', playerData);
                    return { 
                        success: true, 
                        message: 'Data queued for later sync',
                        queued: true 
                    };
                }
            }

            async saveGameData(gameData) {
                try {
                    const formData = new URLSearchParams();
                    formData.append('action', 'saveGame');
                    formData.append('gameData', JSON.stringify(gameData));
                    
                    const response = await fetch(this.apiUrl, {
                        method: 'POST',
                        body: formData
                    });
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    return await response.json();
                    
                } catch (error) {
                    console.warn('Failed to save game data:', error);
                    this.addToPendingSync('game', gameData);
                    return { 
                        success: true, 
                        message: 'Game data queued for sync',
                        queued: true 
                    };
                }
            }

            async saveStores(storesData) {
                try {
                    const formData = new URLSearchParams();
                    formData.append('action', 'saveStores');
                    formData.append('storesData', JSON.stringify(storesData));
                    
                    const response = await fetch(this.apiUrl, {
                        method: 'POST',
                        body: formData
                    });
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    return await response.json();
                    
                } catch (error) {
                    console.warn('Failed to save stores:', error);
                    this.addToPendingSync('stores', storesData);
                    return { 
                        success: true, 
                        message: 'Stores data queued for sync',
                        queued: true 
                    };
                }
            }

            addToPendingSync(type, data) {
                this.pendingSync.push({
                    type: type,
                    data: data,
                    timestamp: Date.now()
                });
                localStorage.setItem('pendingSync', JSON.stringify(this.pendingSync));
            }

            async syncPendingData() {
                if (this.pendingSync.length === 0) {
                    return { success: true, message: 'ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ®ŸäÿßŸÜÿßÿ™ ŸÖÿπŸÑŸÇÿ©' };
                }

                let synced = 0;
                let failed = 0;
                
                for (let i = this.pendingSync.length - 1; i >= 0; i--) {
                    const item = this.pendingSync[i];
                    
                    try {
                        let result;
                        
                        switch(item.type) {
                            case 'player':
                                result = await this.savePlayerData(item.data);
                                break;
                            case 'game':
                                result = await this.saveGameData(item.data);
                                break;
                            case 'stores':
                                result = await this.saveStores(item.data);
                                break;
                        }
                        
                        if (result.success) {
                            this.pendingSync.splice(i, 1);
                            synced++;
                        } else {
                            failed++;
                        }
                        
                    } catch (error) {
                        console.error('Error syncing item:', error);
                        failed++;
                    }
                }
                
                localStorage.setItem('pendingSync', JSON.stringify(this.pendingSync));
                
                return { 
                    success: true, 
                    message: `ÿ™ŸÖÿ™ ŸÖÿ≤ÿßŸÖŸÜÿ© ${synced} ÿπŸÜÿßÿµÿ±ÿå ŸÅÿ¥ŸÑ ${failed}`,
                    synced: synced,
                    failed: failed
                };
            }
        }

        // ===== GAME CLASS =====
        class SlotGame {
            constructor() {
                this.balance = INITIAL_BALANCE;
                this.currentBet = 600;
                this.isSpinning = false;
                this.totalSpins = 0;
                this.totalWins = 0;
                this.totalWon = 0;
                this.biggestWin = 0;
                this.consecutiveLosses = 0;
                
                // Stores System - 4 ŸÖÿÆÿßÿ≤ŸÜ ŸÑŸÉŸÑ ŸÅŸäÿ¥
                this.stores = JSON.parse(JSON.stringify(INITIAL_STORES));
                this.lastWinStore = null;
                
                // Grid
                this.grid = Array(3).fill().map(() => Array(5).fill(null));
                
                // API Service
                this.api = new APIService();
                this.cloudConnected = false;
                
                // DOM Elements
                this.elements = {
                    loading: document.getElementById('loading'),
                    loadingMessage: document.getElementById('loadingMessage'),
                    cloudStatus: document.getElementById('cloudStatus'),
                    syncBtn: document.getElementById('syncBtn'),
                    reels: document.getElementById('reels'),
                    balance: document.getElementById('balance'),
                    currentBet: document.getElementById('currentBet'),
                    spinBtn: document.getElementById('spinBtn'),
                    stopBtn: document.getElementById('stopBtn'),
                    soundToggle: document.getElementById('soundToggle'),
                    helpBtn: document.getElementById('helpBtn'),
                    winDisplay: document.getElementById('winDisplay'),
                    winAmount: document.getElementById('winAmount'),
                    winMultiplier: document.getElementById('winMultiplier'),
                    winTitle: document.getElementById('winTitle'),
                    closeWin: document.getElementById('closeWin'),
                    toast: document.getElementById('toast'),
                    playerId: document.getElementById('playerId'),
                    storesGrid: document.getElementById('storesGrid'),
                    
                    // Stats
                    totalSpins: document.getElementById('totalSpins'),
                    winRate: document.getElementById('winRate'),
                    biggestWin: document.getElementById('biggestWin'),
                    rtpRate: document.getElementById('rtpRate')
                };
                
                // Audio
                this.audio = {
                    spin: document.getElementById('spinSound'),
                    stop: document.getElementById('stopSound'),
                    win: document.getElementById('winSound'),
                    bigWin: document.getElementById('bigWinSound'),
                    click: document.getElementById('clickSound')
                };
                
                this.soundEnabled = true;
                this.lastGameResult = null;
            }
            
            async init() {
                this.createGrid();
                this.createStoresUI();
                this.setupEventListeners();
                await this.loadGameData();
                this.updateUI();
                
                await this.testCloudConnection();
                
                setTimeout(() => {
                    this.elements.loading.style.display = 'none';
                    this.showToast('üé∞ ŸÖÿ±ÿ≠ÿ®ÿßŸã ÿ®ŸÉ ŸÅŸä Slot Machine Pro!', 'info');
                }, 1500);
            }
            
            async testCloudConnection() {
                try {
                    this.elements.loadingMessage.textContent = 'ÿ¨ÿßÿ±Ÿä ÿßŸÑÿßÿ™ÿµÿßŸÑ ÿ®ÿßŸÑÿ≥ÿ≠ÿßÿ®ÿ©...';
                    this.elements.cloudStatus.className = 'cloud-status pending';
                    this.elements.cloudStatus.innerHTML = '<i class="fas fa-sync fa-spin"></i> <span>ÿ¨ÿßÿ±Ÿä ÿßŸÑÿßÿ™ÿµÿßŸÑ...</span>';
                    
                    const pingResult = await this.api.ping();
                    
                    if (pingResult.success) {
                        this.cloudConnected = true;
                        this.elements.cloudStatus.innerHTML = '<i class="fas fa-cloud"></i> <span>ŸÖÿ™ÿµŸÑ ÿ®ÿßŸÑÿ≥ÿ≠ÿßÿ®ÿ©</span>';
                        this.elements.cloudStatus.className = 'cloud-status connected';
                        
                        await this.loadCloudData();
                        
                        this.showToast('‚úÖ ŸÖÿ™ÿµŸÑ ÿ®ÿßŸÑÿ≥ÿ≠ÿßÿ®ÿ© ÿ®ŸÜÿ¨ÿßÿ≠', 'success');
                    } else {
                        this.setOfflineMode();
                    }
                } catch (error) {
                    console.log('Cloud connection failed:', error);
                    this.setOfflineMode();
                }
            }
            
            setOfflineMode() {
                this.cloudConnected = false;
                this.elements.cloudStatus.innerHTML = '<i class="fas fa-cloud-slash"></i> <span>Ÿàÿ∂ÿπ ÿπÿØŸÖ ÿßŸÑÿßÿ™ÿµÿßŸÑ</span>';
                this.elements.cloudStatus.className = 'cloud-status disconnected';
                
                this.showToast('‚ö†Ô∏è ÿßŸÑÿπŸÖŸÑ ŸÅŸä Ÿàÿ∂ÿπ ÿπÿØŸÖ ÿßŸÑÿßÿ™ÿµÿßŸÑ', 'warning');
            }
            
            async loadCloudData() {
                if (!this.cloudConnected) return;
                
                try {
                    const statsResult = await this.api.getStats();
                    if (statsResult.success) {
                        this.updateGlobalStats(statsResult.stats);
                    }
                    
                } catch (error) {
                    console.warn('Error loading cloud data:', error);
                }
            }
            
            updateGlobalStats(cloudStats) {
                if (cloudStats.totalPlayers > 0) {
                    console.log('Global stats loaded:', cloudStats);
                }
            }
            
            async syncWithCloud() {
                try {
                    this.showToast('üîÑ ÿ¨ÿßÿ±Ÿä ÿßŸÑŸÖÿ≤ÿßŸÖŸÜÿ© ŸÖÿπ ÿßŸÑÿ≥ÿ≠ÿßÿ®ÿ©...', 'info');
                    
                    const syncResult = await this.api.syncPendingData();
                    
                    if (syncResult.success) {
                        if (syncResult.synced > 0) {
                            this.showToast(`‚úÖ ÿ™ŸÖÿ™ ŸÖÿ≤ÿßŸÖŸÜÿ© ${syncResult.synced} ÿπŸÜÿµÿ±`, 'success');
                        } else {
                            this.showToast('‚úÖ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ŸÖÿ≠ÿØÿ´ÿ© ÿ®ÿßŸÑŸÅÿπŸÑ', 'info');
                        }
                        
                        await this.loadCloudData();
                    } else {
                        this.showToast('‚ùå ŸÅÿ¥ŸÑÿ™ ÿßŸÑŸÖÿ≤ÿßŸÖŸÜÿ©', 'error');
                    }
                } catch (error) {
                    this.showToast('‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑŸÖÿ≤ÿßŸÖŸÜÿ©', 'error');
                    console.error('Sync error:', error);
                }
            }
            
            createGrid() {
                this.elements.reels.innerHTML = '';
                
                for (let row = 0; row < 3; row++) {
                    for (let col = 0; col < 5; col++) {
                        const cell = document.createElement('div');
                        cell.className = 'reel-cell';
                        cell.dataset.row = row;
                        cell.dataset.col = col;
                        
                        const randomSymbol = SYMBOLS[Math.floor(Math.random() * SYMBOLS.length)];
                        cell.innerHTML = `<div style="font-size: 3em; color: ${randomSymbol.color}">${randomSymbol.icon}</div>`;
                        
                        this.elements.reels.appendChild(cell);
                        this.grid[row][col] = randomSymbol.id;
                    }
                }
            }
            
            createStoresUI() {
                this.elements.storesGrid.innerHTML = '';
                
                Object.entries(this.stores).forEach(([storeKey, store]) => {
                    const percentage = (store.balance / (store.minBalance * 10)) * 100;
                    
                    const storeElement = document.createElement('div');
                    storeElement.className = `store-card ${storeKey}`;
                    storeElement.dataset.store = storeKey;
                    
                    storeElement.innerHTML = `
                        <div class="store-header">
                            <div class="store-info">
                                <div class="store-icon ${storeKey}">${store.icon}</div>
                                <div class="store-details">
                                    <h3>${store.name}</h3>
                                    <div class="store-type">ŸÖÿÆÿ≤ŸÜ ${storeKey === 'normal' ? 'ÿπÿßÿØŸä' : storeKey === 'medium' ? 'ŸÖÿ™Ÿàÿ≥ÿ∑' : storeKey === 'high' ? 'ÿπÿßŸÑŸä' : 'ÿ∂ÿÆŸÖ'}</div>
                                </div>
                            </div>
                            <div class="store-amount ${storeKey}">${Math.round(store.balance).toLocaleString()}</div>
                        </div>
                        <div class="store-progress">
                            <div class="progress-label">
                                <span>ÿßŸÑÿ≠ÿØ ÿßŸÑÿ£ÿØŸÜŸâ: ${store.minBalance.toLocaleString()}</span>
                                <span>${Math.round(percentage)}%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill ${storeKey}" style="width: ${Math.min(percentage, 100)}%"></div>
                            </div>
                            <div class="store-status">
                                <span>ŸÖÿπÿØŸÑ ÿßŸÑÿ™ÿπÿ®ÿ¶ÿ©: ${(store.refillRate * 100)}%</span>
                                <span>ŸÜÿ∑ÿßŸÇ ÿßŸÑŸÖŸÉÿßŸÅÿ£ÿ©: √ó${store.winMultiplier.min}-${store.winMultiplier.max}</span>
                            </div>
                        </div>
                    `;
                    
                    this.elements.storesGrid.appendChild(storeElement);
                });
            }
            
            setupEventListeners() {
                this.elements.spinBtn.addEventListener('click', () => this.spin());
                this.elements.stopBtn.addEventListener('click', () => this.stop());
                
                document.querySelectorAll('.btn-bet').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const bet = parseInt(e.target.dataset.bet);
                        this.setBet(bet);
                        this.playSound('click');
                    });
                });
                
                this.elements.closeWin.addEventListener('click', () => {
                    this.elements.winDisplay.classList.remove('active');
                    this.playSound('click');
                });
                
                this.elements.soundToggle.addEventListener('click', () => {
                    this.toggleSound();
                });
                
                this.elements.syncBtn.addEventListener('click', () => {
                    this.syncWithCloud();
                });
                
                this.elements.helpBtn.addEventListener('click', () => {
                    this.showHelp();
                });
                
                document.addEventListener('keydown', (e) => {
                    if (e.code === 'Space') {
                        e.preventDefault();
                        if (this.isSpinning) {
                            this.stop();
                        } else {
                            this.spin();
                        }
                    }
                    
                    // ÿßÿÆÿ™ÿµÿßÿ±ÿßÿ™ ÿßŸÑÿ±ŸáÿßŸÜ ÿ®ÿßŸÑÿ£ÿ±ŸÇÿßŸÖ
                    if (e.key >= '1' && e.key <= '6' && !this.isSpinning) {
                        const betIndex = parseInt(e.key) - 1;
                        if (betIndex < BET_OPTIONS.length) {
                            this.setBet(BET_OPTIONS[betIndex]);
                            this.playSound('click');
                        }
                    }
                });
            }
            
            setBet(bet) {
                if (this.isSpinning) return;
                
                this.currentBet = bet;
                
                document.querySelectorAll('.btn-bet').forEach(btn => {
                    const btnBet = parseInt(btn.dataset.bet);
                    if (btnBet === bet) {
                        btn.classList.add('active');
                    } else {
                        btn.classList.remove('active');
                    }
                });
                
                this.elements.currentBet.textContent = bet.toLocaleString();
                this.playSound('click');
            }
            
            showHelp() {
                const helpMessage = `
                    <div style="text-align: right; line-height: 1.6;">
                        <h3 style="color: var(--primary); margin-bottom: 15px;">üéÆ ÿØŸÑŸäŸÑ ÿßŸÑŸÑÿπÿ®ÿ©</h3>
                        <p><strong>üéØ ÿßŸÑÿ±ŸáÿßŸÜ:</strong> ÿßÿÆÿ™ÿ± ŸÇŸäŸÖÿ© ÿßŸÑÿ±ŸáÿßŸÜ (300, 600, 1200, 2400, 4800, 9600)</p>
                        <p><strong>üåÄ ÿßŸÑÿ™ÿØŸàŸäÿ±:</strong> ÿßÿ∂ÿ∫ÿ∑ ÿ≤ÿ± ÿßŸÑÿ™ÿØŸàŸäÿ± ÿ£Ÿà ŸÖŸÅÿ™ÿßÿ≠ ÿßŸÑŸÖÿ≥ÿßŸÅÿ©</p>
                        <p><strong>üõë ÿßŸÑÿ•ŸäŸÇÿßŸÅ:</strong> ÿßÿ∂ÿ∫ÿ∑ ÿ≤ÿ± ÿßŸÑÿ•ŸäŸÇÿßŸÅ ÿ£Ÿà ŸÖŸÅÿ™ÿßÿ≠ ÿßŸÑŸÖÿ≥ÿßŸÅÿ© ÿ£ÿ´ŸÜÿßÿ° ÿßŸÑÿ™ÿØŸàŸäÿ±</p>
                        <p><strong>üè¶ ŸÜÿ∏ÿßŸÖ ÿßŸÑŸÖÿÆÿßÿ≤ŸÜ:</strong></p>
                        <ul style="margin-right: 20px;">
                            <li>ŸÖÿÆÿ≤ŸÜ ÿßŸÑÿ£ÿ±ÿ®ÿßÿ≠ ÿßŸÑÿπÿßÿØŸäÿ© (√ó1-5)</li>
                            <li>ŸÖÿÆÿ≤ŸÜ ÿßŸÑÿ£ÿ±ÿ®ÿßÿ≠ ÿßŸÑŸÖÿ™Ÿàÿ≥ÿ∑ÿ© (√ó6-15)</li>
                            <li>ŸÖÿÆÿ≤ŸÜ ÿßŸÑÿ£ÿ±ÿ®ÿßÿ≠ ÿßŸÑÿπÿßŸÑŸäÿ© (√ó16-50)</li>
                            <li>ŸÖÿÆÿ≤ŸÜ ÿßŸÑÿ£ÿ±ÿ®ÿßÿ≠ ÿßŸÑÿ∂ÿÆŸÖÿ© (√ó51-200)</li>
                        </ul>
                        <p><strong>üí∞ ÿßŸÑŸÖŸÉÿßŸÅÿ¢ÿ™:</strong> ŸÉŸÑ ŸÖÿÆÿ≤ŸÜ ŸäÿØŸÅÿπ ŸÖŸÜ ÿ±ÿµŸäÿØŸá ÿßŸÑÿÆÿßÿµ ŸàŸÑÿß ŸäŸÅÿ±ÿ∫ ÿ£ÿ®ÿØÿßŸã</p>
                        <p><strong>üé∞ ÿßÿÆÿ™ÿµÿßÿ±ÿßÿ™:</strong> ÿßŸÑÿ£ÿ±ŸÇÿßŸÖ 1-6 ŸÑÿ™ÿ∫ŸäŸäÿ± ÿßŸÑÿ±ŸáÿßŸÜ ÿ®ÿ≥ÿ±ÿπÿ©</p>
                    </div>
                `;
                
                this.showToast(helpMessage, 'info', 8000);
            }
            
            async spin() {
                if (this.isSpinning) return;
                
                if (this.balance < this.currentBet) {
                    this.showToast('üí∞ ÿ±ÿµŸäÿØŸÉ ÿ∫Ÿäÿ± ŸÉÿßŸÅŸä!', 'error');
                    return;
                }
                
                // ÿÆÿµŸÖ ÿßŸÑÿ±ŸáÿßŸÜ ŸÖŸÜ ÿßŸÑÿ±ÿµŸäÿØ
                this.balance -= this.currentBet;
                this.totalSpins++;
                this.consecutiveLosses++;
                
                // ÿ™Ÿàÿ≤Ÿäÿπ ÿßŸÑÿ±ŸáÿßŸÜ ÿπŸÑŸâ ÿßŸÑŸÖÿÆÿßÿ≤ŸÜ (80%) ŸàÿßŸÑŸÖŸÉÿßÿ≥ÿ® (20%)
                this.distributeBetToStores();
                
                this.isSpinning = true;
                this.elements.spinBtn.disabled = true;
                this.elements.stopBtn.disabled = false;
                
                this.playSound('spin');
                this.animateSpin();
                this.generateResults();
                
                // ÿ•ŸäŸÇÿßŸÅ ÿ™ŸÑŸÇÿßÿ¶Ÿä ÿ®ÿπÿØ 3 ÿ´ŸàÿßŸÜŸä
                setTimeout(() => {
                    if (this.isSpinning) {
                        this.stop();
                    }
                }, 3000);
                
                this.updateUI();
                await this.saveGameData();
            }
            
            distributeBetToStores() {
                const totalForStores = this.currentBet * (1 - SITE_PROFIT_PERCENTAGE); // 80%
                
                Object.values(this.stores).forEach(store => {
                    store.balance += totalForStores * store.refillRate; // 20% ŸÑŸÉŸÑ ŸÖÿÆÿ≤ŸÜ
                });
                
                this.createStoresUI();
            }
            
            animateSpin() {
                const cells = document.querySelectorAll('.reel-cell');
                cells.forEach(cell => {
                    cell.classList.add('spinning');
                    
                    const interval = setInterval(() => {
                        const randomSymbol = SYMBOLS[Math.floor(Math.random() * SYMBOLS.length)];
                        cell.innerHTML = `<div style="font-size: 3em; color: ${randomSymbol.color}">${randomSymbol.icon}</div>`;
                    }, 60);
                    
                    cell.dataset.interval = interval;
                });
            }
            
            generateResults() {
                const selectedStore = this.selectWinningStore();
                
                if (selectedStore) {
                    this.createWinFromStore(selectedStore);
                    this.lastWinStore = selectedStore;
                } else {
                    this.createRandomGrid();
                    this.lastWinStore = null;
                }
                
                if (this.consecutiveLosses >= 12) {
                    this.forceGuaranteedWin();
                    this.consecutiveLosses = 0;
                }
            }
            
            selectWinningStore() {
                const availableStores = Object.entries(this.stores).filter(([key, store]) => {
                    return store.balance > store.minBalance * 2;
                });
                
                if (availableStores.length === 0) return null;
                
                // ÿ≠ÿ≥ÿßÿ® ÿßÿ≠ÿ™ŸÖÿßŸÑÿßÿ™ ÿßŸÑŸÅŸàÿ≤ ÿ®ŸÜÿßÿ°Ÿã ÿπŸÑŸâ ÿ™Ÿàÿßÿ≤ŸÜ ÿßŸÑŸÖÿÆÿßÿ≤ŸÜ
                const totalBalance = availableStores.reduce((sum, [key, store]) => sum + store.balance, 0);
                const probabilities = availableStores.map(([key, store]) => ({
                    key,
                    probability: (store.balance / totalBalance) * 100
                }));
                
                const totalProbability = probabilities.reduce((sum, p) => sum + p.probability, 0);
                let random = Math.random() * totalProbability;
                
                for (const { key, probability } of probabilities) {
                    random -= probability;
                    if (random <= 0) {
                        return key;
                    }
                }
                
                return availableStores[0][0];
            }
            
            createWinFromStore(storeKey) {
                const store = this.stores[storeKey];
                const winType = this.determineWinType(store);
                
                if (winType === 'small') {
                    this.createSmallWin();
                } else if (winType === 'medium') {
                    this.createMediumWin();
                } else if (winType === 'large') {
                    this.createLargeWin();
                } else if (winType === 'v-shape') {
                    this.createVShapeWin();
                }
            }
            
            determineWinType(store) {
                const storeRatio = store.balance / store.minBalance;
                
                if (storeRatio > 10) {
                    return Math.random() < 0.3 ? 'v-shape' : 'large';
                } else if (storeRatio > 5) {
                    return Math.random() < 0.4 ? 'large' : 'medium';
                } else if (storeRatio > 2) {
                    return Math.random() < 0.5 ? 'medium' : 'small';
                } else {
                    return 'small';
                }
            }
            
            createSmallWin() {
                const symbol = SYMBOLS[Math.floor(Math.random() * 6)]; // ÿ±ŸÖŸàÿ≤ ÿ∞ÿßÿ™ ŸÖÿ∂ÿßÿπŸÅÿßÿ™ ŸÖŸÜÿÆŸÅÿ∂ÿ©
                const row = Math.floor(Math.random() * 3);
                
                for (let col = 0; col < 3; col++) {
                    this.grid[row][col] = symbol.id;
                }
            }
            
            createMediumWin() {
                const symbol = SYMBOLS[Math.floor(Math.random() * 9)];
                const row = Math.floor(Math.random() * 3);
                
                for (let col = 0; col < 4; col++) {
                    this.grid[row][col] = symbol.id;
                }
            }
            
            createLargeWin() {
                const symbol = SYMBOLS[Math.floor(Math.random() * 9)];
                const row = Math.floor(Math.random() * 3);
                
                for (let col = 0; col < 5; col++) {
                    this.grid[row][col] = symbol.id;
                }
            }
            
            createVShapeWin() {
                const symbol = SYMBOLS[Math.floor(Math.random() * 9)];
                const positions = [[0,0], [1,1], [2,2], [1,3], [0,4]];
                
                positions.forEach(([row, col]) => {
                    this.grid[row][col] = symbol.id;
                });
            }
            
            createRandomGrid() {
                for (let row = 0; row < 3; row++) {
                    for (let col = 0; col < 5; col++) {
                        this.grid[row][col] = SYMBOLS[Math.floor(Math.random() * SYMBOLS.length)].id;
                    }
                }
            }
            
            forceGuaranteedWin() {
                const availableStores = Object.entries(this.stores).filter(([key, store]) => {
                    return store.balance > store.minBalance * 1.5;
                });
                
                if (availableStores.length === 0) return;
                
                const [storeKey] = availableStores[Math.floor(Math.random() * availableStores.length)];
                this.createSmallWin();
                this.lastWinStore = storeKey;
                
                this.showToast('üçÄ ÿ≠ÿ∏ÿßŸã ÿ£ŸÅÿ∂ŸÑ Ÿáÿ∞Ÿá ÿßŸÑŸÖÿ±ÿ©!', 'warning');
            }
            
            async stop() {
                if (!this.isSpinning) return;
                
                this.isSpinning = false;
                this.elements.spinBtn.disabled = false;
                this.elements.stopBtn.disabled = true;
                
                const cells = document.querySelectorAll('.reel-cell');
                cells.forEach(cell => {
                    cell.classList.remove('spinning');
                    clearInterval(cell.dataset.interval);
                });
                
                this.playSound('stop');
                this.showResults();
                
                setTimeout(async () => {
                    const results = this.checkWins();
                    await this.processResults(results);
                }, 700);
            }
            
            showResults() {
                const cells = document.querySelectorAll('.reel-cell');
                
                cells.forEach((cell, index) => {
                    const row = Math.floor(index / 5);
                    const col = index % 5;
                    const symbolId = this.grid[row][col];
                    const symbol = SYMBOLS.find(s => s.id === symbolId);
                    
                    if (symbol) {
                        cell.innerHTML = `<div style="font-size: 3em; color: ${symbol.color}">${symbol.icon}</div>`;
                    }
                });
            }
            
            checkWins() {
                const results = {
                    wins: [],
                    totalMultiplier: 0,
                    totalWin: 0,
                    winningSymbol: null,
                    storeUsed: null
                };
                
                // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑÿµŸÅŸàŸÅ ÿßŸÑÿ£ŸÅŸÇŸäÿ©
                for (let row = 0; row < 3; row++) {
                    const line = this.grid[row];
                    let count = 1;
                    let currentSymbol = line[0];
                    
                    for (let col = 1; col < 5; col++) {
                        if (line[col] === currentSymbol) {
                            count++;
                        } else {
                            break;
                        }
                    }
                    
                    if (count >= 3) {
                        const symbol = SYMBOLS.find(s => s.id === currentSymbol);
                        const baseMultiplier = symbol.multiplier;
                        const multiplier = this.calculateWinMultiplier(count, baseMultiplier);
                        
                        results.wins.push({
                            type: 'horizontal',
                            row: row,
                            count: count,
                            symbol: currentSymbol,
                            symbolName: symbol.name,
                            multiplier: multiplier
                        });
                        
                        results.totalMultiplier += multiplier;
                        results.winningSymbol = currentSymbol;
                    }
                }
                
                // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿ¥ŸÉŸÑ V
                const vPositions = [[0,0], [1,1], [2,2], [1,3], [0,4]];
                const vSymbols = vPositions.map(([r, c]) => this.grid[r][c]);
                const isV = vSymbols.every(s => s === vSymbols[0]);
                
                if (isV) {
                    const symbol = SYMBOLS.find(s => s.id === vSymbols[0]);
                    const multiplier = symbol.multiplier * 20;
                    
                    results.wins.push({
                        type: 'v-shape',
                        count: 5,
                        symbol: vSymbols[0],
                        symbolName: symbol.name,
                        multiplier: multiplier
                    });
                    
                    results.totalMultiplier += multiplier;
                    results.winningSymbol = vSymbols[0];
                }
                
                // ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑŸÖÿÆÿ≤ŸÜ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ŸÑŸÑÿØŸÅÿπ
                if (results.totalMultiplier > 0) {
                    results.storeUsed = this.determineStoreForWin(results.totalMultiplier);
                    results.totalWin = this.currentBet * results.totalMultiplier;
                }
                
                return results;
            }
            
            calculateWinMultiplier(count, baseMultiplier) {
                if (count === 3) return baseMultiplier;
                if (count === 4) return baseMultiplier * 3;
                if (count === 5) return baseMultiplier * 10;
                return baseMultiplier;
            }
            
            determineStoreForWin(multiplier) {
                if (multiplier >= 51) return 'mega';
                if (multiplier >= 16) return 'high';
                if (multiplier >= 6) return 'medium';
                return 'normal';
            }
            
            async processResults(results) {
                this.highlightWins(results);
                
                if (results.totalWin > 0) {
                    this.consecutiveLosses = 0;
                    this.totalWins++;
                    this.totalWon += results.totalWin;
                    this.balance += results.totalWin;
                    
                    if (results.totalWin > this.biggestWin) {
                        this.biggestWin = results.totalWin;
                    }
                    
                    // ÿÆÿµŸÖ ÿßŸÑŸÖŸÉÿßÿ≥ÿ® ŸÖŸÜ ÿßŸÑŸÖÿÆÿ≤ŸÜ ÿßŸÑŸÖŸÜÿßÿ≥ÿ®
                    if (results.storeUsed) {
                        this.deductFromStore(results.storeUsed, results.totalWin);
                    }
                    
                    const winSize = this.determineWinSize(results.totalWin);
                    this.showWinDisplay(results.totalWin, results.totalMultiplier, winSize, results.storeUsed);
                    
                    if (winSize === 'mega') {
                        this.playSound('bigWin');
                        this.showToast(`üéä ŸÅŸàÿ≤ ÿ∂ÿÆŸÖ! ${results.totalWin.toLocaleString()}`, 'success');
                    } else if (winSize === 'high') {
                        this.playSound('win');
                        this.showToast(`üéâ ŸÅŸàÿ≤ ŸÉÿ®Ÿäÿ±! ${results.totalWin.toLocaleString()}`, 'success');
                    } else {
                        this.playSound('win');
                    }
                    
                    this.lastGameResult = results;
                    
                } else {
                    const nearWins = this.checkNearWins();
                    if (nearWins > 0) {
                        this.showToast('‚ö° ŸÉÿßÿØÿ™ ÿ£ŸÜ ÿ™ŸÅŸàÿ≤!', 'warning');
                    }
                }
                
                this.refillLowStores();
                this.updateUI();
                await this.saveGameData();
            }
            
            determineWinSize(winAmount) {
                const ratio = winAmount / this.currentBet;
                
                if (ratio >= 50) return 'mega';
                if (ratio >= 15) return 'high';
                if (ratio >= 5) return 'medium';
                return 'normal';
            }
            
            deductFromStore(storeKey, amount) {
                const store = this.stores[storeKey];
                const available = store.balance - store.minBalance;
                
                if (available <= 0) {
                    this.showToast(`‚ö†Ô∏è ŸÖÿÆÿ≤ŸÜ ${store.name} ŸÖŸÜÿÆŸÅÿ∂ÿå ÿ≥Ÿäÿ™ŸÖ ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ŸÖÿÆÿßÿ≤ŸÜ ÿ£ÿÆÿ±Ÿâ`, 'warning');
                    this.distributePayout(amount);
                    return;
                }
                
                const deduction = Math.min(amount, available);
                store.balance -= deduction;
                
                if (deduction < amount) {
                    const remaining = amount - deduction;
                    this.distributePayout(remaining);
                }
                
                this.createStoresUI();
            }
            
            distributePayout(amount) {
                const otherStores = Object.entries(this.stores).filter(([key]) => key !== this.lastWinStore);
                
                otherStores.forEach(([key, store]) => {
                    const available = store.balance - store.minBalance;
                    if (available > 0) {
                        const share = Math.min(amount / otherStores.length, available);
                        store.balance -= share;
                    }
                });
                
                this.createStoresUI();
            }
            
            refillLowStores() {
                Object.entries(this.stores).forEach(([key, store]) => {
                    if (store.balance < store.minBalance * 1.5) {
                        const otherStores = Object.entries(this.stores).filter(([k]) => k !== key);
                        const totalAvailable = otherStores.reduce((sum, [k, s]) => {
                            const available = s.balance - s.minBalance * 2;
                            return sum + Math.max(0, available);
                        }, 0);
                        
                        if (totalAvailable > 0) {
                            const needed = store.minBalance * 2 - store.balance;
                            const transfer = Math.min(needed, totalAvailable * 0.2);
                            
                            if (transfer > 0) {
                                otherStores.forEach(([k, s]) => {
                                    const available = s.balance - s.minBalance * 2;
                                    if (available > 0) {
                                        const share = (available / totalAvailable) * transfer;
                                        s.balance -= share;
                                        store.balance += share;
                                    }
                                });
                            }
                        }
                    }
                });
                
                this.createStoresUI();
            }
            
            highlightWins(results) {
                document.querySelectorAll('.reel-cell').forEach(cell => {
                    cell.classList.remove('matched');
                    cell.classList.remove('mega-win');
                });
                
                results.wins.forEach(win => {
                    if (win.type === 'horizontal') {
                        for (let col = 0; col < win.count; col++) {
                            const cell = document.querySelector(
                                `.reel-cell[data-row="${win.row}"][data-col="${col}"]`
                            );
                            if (cell) {
                                cell.classList.add('matched');
                                if (win.multiplier >= 100) {
                                    cell.classList.add('mega-win');
                                }
                            }
                        }
                    } else if (win.type === 'v-shape') {
                        const positions = [[0,0], [1,1], [2,2], [1,3], [0,4]];
                        positions.forEach(([row, col]) => {
                            const cell = document.querySelector(
                                `.reel-cell[data-row="${row}"][data-col="${col}"]`
                            );
                            if (cell) {
                                cell.classList.add('matched');
                                cell.classList.add('mega-win');
                            }
                        });
                    }
                });
            }
            
            checkNearWins() {
                let nearWins = 0;
                for (let row = 0; row < 3; row++) {
                    for (let col = 0; col < 4; col++) {
                        if (this.grid[row][col] === this.grid[row][col + 1]) {
                            nearWins++;
                        }
                    }
                }
                return nearWins;
            }
            
            showWinDisplay(amount, multiplier, winSize = 'normal', storeUsed = 'normal') {
                this.elements.winAmount.textContent = amount.toLocaleString();
                this.elements.winMultiplier.textContent = `√ó${multiplier}`;
                
                if (winSize === 'mega') {
                    this.elements.winTitle.textContent = 'üéä ŸÅŸàÿ≤ ÿ∂ÿÆŸÖ! üéä';
                    this.elements.winDisplay.className = 'win-display mega-win';
                } else if (winSize === 'high') {
                    this.elements.winTitle.textContent = 'üéâ ŸÅŸàÿ≤ ŸÉÿ®Ÿäÿ±! üéâ';
                    this.elements.winDisplay.className = 'win-display high-win';
                } else if (winSize === 'medium') {
                    this.elements.winTitle.textContent = '‚ú® ŸÅŸàÿ≤ ŸÖÿ™Ÿàÿ≥ÿ∑! ‚ú®';
                    this.elements.winDisplay.className = 'win-display medium-win';
                } else {
                    this.elements.winTitle.textContent = 'üéØ ŸÅŸàÿ≤! üéØ';
                    this.elements.winDisplay.className = 'win-display normal-win';
                }
                
                this.elements.winDisplay.classList.add('active');
            }
            
            // ===== AUDIO =====
            playSound(soundName) {
                if (!this.soundEnabled || !this.audio[soundName]) return;
                
                try {
                    const sound = this.audio[soundName].cloneNode();
                    sound.volume = soundName === 'win' || soundName === 'bigWin' ? 0.7 : 0.5;
                    sound.play().catch(() => {});
                } catch (error) {
                    console.warn('Error playing sound:', error);
                }
            }
            
            toggleSound() {
                this.soundEnabled = !this.soundEnabled;
                
                const icon = this.elements.soundToggle.querySelector('i');
                icon.className = this.soundEnabled ? 'fas fa-volume-up' : 'fas fa-volume-mute';
                
                localStorage.setItem('slotSoundEnabled', this.soundEnabled.toString());
                
                const message = this.soundEnabled ? 'üîä ÿßŸÑÿµŸàÿ™ ŸÖŸÅÿπŸÑ' : 'üîá ÿßŸÑÿµŸàÿ™ ŸÖÿπÿ∑ŸÑ';
                this.showToast(message);
                
                if (this.soundEnabled) {
                    this.playSound('click');
                }
            }
            
            // ===== UI =====
            updateUI() {
                this.elements.balance.textContent = this.balance.toLocaleString();
                
                this.elements.totalSpins.textContent = this.totalSpins.toLocaleString();
                
                const winRate = this.totalSpins > 0 ? 
                    ((this.totalWins / this.totalSpins) * 100).toFixed(1) : 0;
                this.elements.winRate.textContent = `${winRate}%`;
                
                this.elements.biggestWin.textContent = this.biggestWin.toLocaleString();
                
                const totalBet = this.totalSpins * this.currentBet;
                const rtp = totalBet > 0 ? 
                    ((this.totalWon / totalBet) * 100).toFixed(1) : 96.5;
                this.elements.rtpRate.textContent = `${Math.min(rtp, 99.9)}%`;
                
                this.elements.playerId.textContent = `ID: ${this.api.playerId.substr(0, 8)}...`;
            }
            
            showToast(message, type = 'info', duration = 3000) {
                const toast = this.elements.toast;
                const icon = toast.querySelector('.toast-icon');
                const messageEl = toast.querySelector('.toast-message');
                
                messageEl.innerHTML = message;
                
                toast.className = 'toast';
                if (type === 'error') {
                    toast.classList.add('error');
                    icon.innerHTML = '‚ùå';
                } else if (type === 'warning') {
                    toast.classList.add('warning');
                    icon.innerHTML = '‚ö†Ô∏è';
                } else if (type === 'success') {
                    toast.classList.add('success');
                    icon.innerHTML = '‚úÖ';
                } else {
                    toast.classList.add('info');
                    icon.innerHTML = '‚ÑπÔ∏è';
                }
                
                toast.classList.add('show');
                
                clearTimeout(this.toastTimeout);
                this.toastTimeout = setTimeout(() => {
                    toast.classList.remove('show');
                }, duration);
            }
            
            // ===== DATA MANAGEMENT =====
            async loadGameData() {
                try {
                    const saved = localStorage.getItem('slotGameData');
                    if (saved) {
                        const data = JSON.parse(saved);
                        
                        this.balance = data.balance || INITIAL_BALANCE;
                        this.currentBet = data.currentBet || 600;
                        this.totalSpins = data.totalSpins || 0;
                        this.totalWins = data.totalWins || 0;
                        this.totalWon = data.totalWon || 0;
                        this.biggestWin = data.biggestWin || 0;
                    }
                    
                    const savedStores = localStorage.getItem('slotStores');
                    if (savedStores) {
                        const storesData = JSON.parse(savedStores);
                        Object.keys(storesData).forEach(key => {
                            if (this.stores[key]) {
                                this.stores[key].balance = storesData[key].balance || this.stores[key].balance;
                            }
                        });
                    }
                    
                    this.soundEnabled = localStorage.getItem('slotSoundEnabled') !== 'false';
                    const icon = this.elements.soundToggle.querySelector('i');
                    icon.className = this.soundEnabled ? 'fas fa-volume-up' : 'fas fa-volume-mute';
                    
                } catch (error) {
                    console.error('Error loading game data:', error);
                }
            }
            
            async saveGameData() {
                // ÿ≠ŸÅÿ∏ ŸÖÿ≠ŸÑŸä
                const gameData = {
                    balance: this.balance,
                    currentBet: this.currentBet,
                    totalSpins: this.totalSpins,
                    totalWins: this.totalWins,
                    totalWon: this.totalWon,
                    biggestWin: this.biggestWin
                };
                
                localStorage.setItem('slotGameData', JSON.stringify(gameData));
                localStorage.setItem('slotStores', JSON.stringify(this.stores));
                
                // ÿ≠ŸÅÿ∏ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÑÿßÿπÿ®
                await this.api.savePlayerData({
                    id: this.api.playerId,
                    name: `Player_${this.api.playerId.substr(0, 6)}`,
                    balance: this.balance,
                    spins: this.totalSpins,
                    wins: this.totalWins,
                    totalWin: this.totalWon
                });
                
                // ÿ≠ŸÅÿ∏ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿÆÿßÿ≤ŸÜ
                await this.api.saveStores(this.stores);
                
                // ÿ≠ŸÅÿ∏ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ¨ŸÑÿ≥ÿ© ÿ•ÿ∞ÿß ŸÉÿßŸÜ ŸáŸÜÿßŸÉ ŸÅŸàÿ≤
                if (this.lastGameResult && this.lastGameResult.totalWin > 0) {
                    await this.api.saveGameData({
                        playerId: this.api.playerId,
                        bet: this.currentBet,
                        win: this.lastGameResult.totalWin,
                        storeUsed: this.lastGameResult.storeUsed || 'normal',
                        multiplier: this.lastGameResult.totalMultiplier
                    });
                }
            }
        }

        // ===== INITIALIZE GAME =====
        window.addEventListener('DOMContentLoaded', async () => {
            window.slotGame = new SlotGame();
            await window.slotGame.init();
            
            // ÿ•ÿ∂ÿßŸÅÿ© ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿ•ÿ∂ÿßŸÅŸäÿ© ÿπŸÜÿØ ÿßŸÑÿ™ŸÖÿ±Ÿäÿ±
            window.addEventListener('resize', () => {
                const reelSize = Math.min(320, window.innerWidth / 6);
                document.documentElement.style.setProperty('--reel-size', `${reelSize}px`);
            });
            
            // ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿ≠ÿØÿ´ ÿßŸÑÿ£ŸàŸÑ
            window.dispatchEvent(new Event('resize'));
        });
    </script>
</body>
</html>
